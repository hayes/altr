<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Decorators</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <link href="" rel="alternate" type="application/rss+xml" title="altr" />
  <link href="https://altr.hayes.io/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://altr.hayes.io/css/hc.css" rel="stylesheet">
  <link href="https://altr.hayes.io/css/monokai.css" rel="stylesheet">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  
    
    </head>
    <body>
<div class="nav-toggle"><i class="fa fa-bars fa-2x"></i> Herring Cove </div>
      <div id = "wrapper">


<div class="navbar navbar-default" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <p class="navbar-brand">altr</p>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            
            
            <li class="">
              <a href="https://altr.hayes.io/index.html">Overview</a>
              
            </li>
            
            <li class="">
              <a href="https://altr.hayes.io/getting-started/">Getting Started</a>
              
            </li>
            
            <li class="">
              <a href="https://altr.hayes.io/expressions/">Expressions</a>
              
              <ul>
              
                <li class=""><a href="https://altr.hayes.io/expressions/values/">Values</a></li>
              
                <li class=""><a href="https://altr.hayes.io/expressions/opperations/">Opperations</a></li>
              
                <li class=""><a href="https://altr.hayes.io/expressions/filters/">Filters</a></li>
              
              </ul>
              
            </li>
            
            <li class="">
              <a href="https://altr.hayes.io/tags/">Tags</a>
              
              <ul>
              
                <li class=""><a href="https://altr.hayes.io/tags/children/">children</a></li>
              
                <li class=""><a href="https://altr.hayes.io/tags/for/">for</a></li>
              
                <li class=""><a href="https://altr.hayes.io/tags/html/">html</a></li>
              
                <li class=""><a href="https://altr.hayes.io/tags/if/">if</a></li>
              
                <li class=""><a href="https://altr.hayes.io/tags/include/">include</a></li>
              
                <li class=""><a href="https://altr.hayes.io/tags/raw/">raw</a></li>
              
                <li class=""><a href="https://altr.hayes.io/tags/replace/">replace</a></li>
              
                <li class=""><a href="https://altr.hayes.io/tags/text/">text</a></li>
              
                <li class=""><a href="https://altr.hayes.io/tags/with/">with</a></li>
              
              </ul>
              
            </li>
            
            <li class=" active">
              <a href="https://altr.hayes.io/decorators/">Decorators</a>
              
            </li>
            
            <li class="">
              <a href="https://altr.hayes.io/node/">Node</a>
              
            </li>
            
            <li class="">
              <a href="https://altr.hayes.io/api/">API</a>
              
            </li>
            
          </ul>
        </div>
      </div>
    </div>



       
       <div id="sidebar-wrapper">
        <ul class="sidebar-nav">
          <li class="sidebar-brand"><a href="https://altr.hayes.io/"><h1 class="brand">altr</h1></a><h3></h3></li>
          <hr />
          
          
          <li class="">
            <a href="https://altr.hayes.io/index.html">Overview</a>
            
          </li>
          
          <li class="">
            <a href="https://altr.hayes.io/getting-started/">Getting Started</a>
            
          </li>
          
          <li class="">
            <a href="https://altr.hayes.io/expressions/">Expressions</a>
            
            <ul>
            
              <li class=""><a href="https://altr.hayes.io/expressions/values/">Values</a></li>
            
              <li class=""><a href="https://altr.hayes.io/expressions/opperations/">Opperations</a></li>
            
              <li class=""><a href="https://altr.hayes.io/expressions/filters/">Filters</a></li>
            
            </ul>
            
          </li>
          
          <li class="">
            <a href="https://altr.hayes.io/tags/">Tags</a>
            
            <ul>
            
              <li class=""><a href="https://altr.hayes.io/tags/children/">children</a></li>
            
              <li class=""><a href="https://altr.hayes.io/tags/for/">for</a></li>
            
              <li class=""><a href="https://altr.hayes.io/tags/html/">html</a></li>
            
              <li class=""><a href="https://altr.hayes.io/tags/if/">if</a></li>
            
              <li class=""><a href="https://altr.hayes.io/tags/include/">include</a></li>
            
              <li class=""><a href="https://altr.hayes.io/tags/raw/">raw</a></li>
            
              <li class=""><a href="https://altr.hayes.io/tags/replace/">replace</a></li>
            
              <li class=""><a href="https://altr.hayes.io/tags/text/">text</a></li>
            
              <li class=""><a href="https://altr.hayes.io/tags/with/">with</a></li>
            
            </ul>
            
          </li>
          
          <li class=" active">
            <a href="https://altr.hayes.io/decorators/">Decorators</a>
            
          </li>
          
          <li class="">
            <a href="https://altr.hayes.io/node/">Node</a>
            
          </li>
          
          <li class="">
            <a href="https://altr.hayes.io/api/">API</a>
            
          </li>
          
          <hr />
          <div id="social-wrapper">
           
           
           
           <li> <a href="https://github.com/hayes/altr"><i class="fa fa-github-square"></i> github</a> </li>
         </div>
       </ul>
     </div>



     <div class="container">


  <div id="article">
    <div class="article-title">Decorators</div>
    <hr/>
    <div class="post">
      

<h2 id="toc_0">Overview</h2>

<p>Decorators are a very powerful yet simple way to hook into altr to add
new functionality.  Once a decorator has been defined (see below) it can be
used to decorate any element in a template.</p>

<p>Decorators provide 5 places in an elements lifecyle that can be hooked into:
<code>create</code>, <code>insert</code>, <code>update</code>, <code>remove</code>, and <code>destroy</code>.</p>

<h2 id="toc_1">Defining</h2>

<p>To add a new decorator to altr:</p>

<pre><code class="language-javascript">altr.addDecorator('unique-attribute', create)
altr(
    '&lt;div unique-attribute=&quot;a.b.c, 5 * 10, 'foo'&quot;&gt;&lt;/div&gt;'
  , {a: {b: {c: 123}}}
)

function create(el) {
  return {
      insert: function(el) {}
    , update: function(arg1, arg2, argn) {}
    , remove: function(el, done) {setTimeout(done, 500)})
    , destroy: function() {}
  }
}
</code></pre>

<p>The first argument is the attribute the decorator will be bound to.  Any time
an element is created in an <code>altr</code> template that has this attribute the create
function will be called with that element.</p>

<h3 id="toc_2"><code>create(el)</code></h3>

<p>Each time an element with a matching attribute is added to the template this
function will be called.</p>

<p>Most elements in altr are initialized when the template is first created.  This means that even if the decorated element is
initially inside an <a href="../tags/if">if tag</a> that is <code>falsy</code> the create function will
still be called.  This is because altr was written with the understand that the
state of a template is likely to change.  Because of this, it is good to use
an update hook if the decorator has expectations about the current state.</p>

<p>The main exception to the above, is the <a href="../tags/for">for tag</a>.  For tags
create a sub template for each item it its list. A decorator on an element
will only be created once for each item, even if there are multiple updates
that change that items index in the list. the documentation for the <a href="../tags/for">for tag</a> has more details on how uniqueness and presence in a list is
determined.</p>

<p>To hook in to the other lifecycle hooks, the create function may return an
object with any/all of the below methods.</p>

<p>The create function is called with the altr instance that it is part of as
its context.</p>

<p>Decorators should use <code>this.document</code> rather than the global document if they
need to, this maintains compatability with node.</p>

<h3 id="toc_3"><code>update(arg1[, arg2, ...argN])</code></h3>

<p>A decorators attribute value can specify a comma seperated list of
<a href="../expressions">expressions</a> to watch.  When the the decorator is first
create and any time any of the watched values change, the decorators <code>update</code>
function is called, with the current values as arguments.</p>

<h3 id="toc_4"><code>insert(el)</code></h3>

<p>A decorators insert function is called any time its element is inserted into
the dom.  It receives 1 argument, <code>el</code>.  This is the element responsible for
the insertion. this is generally either an <a href="../tags/if">if tag</a> or a  <a href="../tags/for">for tag</a>.  <code>el</code> may also be <code>null</code> if the entire template is being
inserted into a new node.</p>

<h3 id="toc_5"><code>remove(el, done)</code></h3>

<p>A decorators remove function is called any time its element is inserted into
the dom.  It receives 2 arguments, <code>el</code> amd <code>done</code>.  el is the same as the
the first agument for insert. <code>done</code> is a call back that MUST be called once
the decorator is ready to be removed. <code>done</code> MAY be called asynchronously, but
MUST only be called once.</p>

<p><code>remove</code> is asynchronus to allow for exit transitions before an element is
removed form the dom.</p>

<h3 id="toc_6"><code>destroy()</code></h3>

<p><code>destroy</code> is called once the decorators element has been removed from the dom
and will not be reinserted. This allows a decorator to clean up any remaining
event listeners or other state such as <code>setInterval</code> calls.</p>

<h2 id="toc_7">Examples</h2>

<h3 id="toc_8">escape HTML</h3>

<div altr-example altr-raw="true">
  <ul name="tabs" altr-for="tab in tabs">
    <li
      class="{% tab === activeTab ? 'active' : '' %}"
      data-view="{% tab %}"
    >
    {% tab %}
    </li>
  </ul>
  <div class="tab-content" style="height: 150px;">
    <div altr-replace="els[activeTab]"></div>
  </div>
  <div
    data-type="javascript"
    class="{% activeTab === 'javascript'' ? '' : 'ahidden' %}"
    altr-raw
><pre><code>altr.addDecorator('altr-escape', escape)
altr(document.body, {})

function escape(el) {
  var pre = this.document.createElement('pre')

  pre.textContent = el.innerHTML
  el.innerHTML = ''
  el.appendChild(pre)
}
</code></pre>
</div>
<div
    data-type="html"
    class="{% activeTab === 'html'' ? '' : 'ahidden' %}"
    altr-raw
><pre><code>&lt;div altr-raw altr-escape&gt;
  &lt;h1&gt;hello, World!&lt;/h1&gt;
&lt;/div&gt;
</code></pre>
</div>

<p></div></p>

<h3 id="toc_9">fade out</h3>

<div altr-example altr-raw="true">
  <ul name="tabs" altr-for="tab in tabs">
    <li
      class="{% tab === activeTab ? 'active' : '' %}"
      data-view="{% tab %}"
    >
    {% tab %}
    </li>
  </ul>
  <div class="tab-content" style="height: 450px;">
    <div altr-replace="els[activeTab]"></div>
  </div>
  <div
    data-type="javascript"
    class="{% activeTab === 'javascript'' ? '' : 'ahidden' %}"
    altr-raw
><pre><code>altr.addDecorator('fade-out', fade)
var template = altr(document.body, {})

document.addEventListener('click', function() {
  template.update({remove: true})
})

function fade(root) {
  return {remove: remove}

  function remove(el, done) {
    var start = new Date

    step()

    function step() {
      var diff = new Date - start

      if(diff &gt; 1000) {
        return done()
      }

      el.style.opacity = 1 - (diff / 1000)
      setTimeout(step, 15)
    }
  }
}
</code></pre>
</div>
<div
    data-type="html"
    class="{% activeTab === 'html'' ? '' : 'ahidden' %}"
    altr-raw
><pre><code>&lt;div altr-if=&quot;!remove&quot; fade-out&gt;
  &lt;div&gt;click to fade out!&lt;/div&gt;
&lt;/div&gt;
</code></pre>
</div>

<p></div></p>

<h3 id="toc_10">2-way binding</h3>

    </div>
  </div>
    <footer>

        <p class="text-muted credit">&copy; . All rights reserved. </p>
    </footer>
 
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
    <script src="/js/jquery-1.10.2.min.js"></script>
    <script src="/js/altr.js"></script>
    <script src="/js/examples.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/bootstrap.js"></script>
    <script type="text/javascript" src="/js/hc.js"></script>
</body>

</html>

