{"version":3,"file":"bundle.js","sources":["/Users/mhayes/code/altr/node_modules/browserify/node_modules/browser-pack/_prelude.js","/Users/mhayes/code/altr/lib/browser.js","/Users/mhayes/code/altr/lib/index.js","/Users/mhayes/code/altr/lib/tags/placeholder.js","/Users/mhayes/code/altr/lib/tags/children.js","/Users/mhayes/code/altr/lib/tags/include.js","/Users/mhayes/code/altr/lib/tags/text.js","/Users/mhayes/code/altr/lib/tags/html.js","/Users/mhayes/code/altr/lib/tags/with.js","/Users/mhayes/code/altr/lib/tags/for.js","/Users/mhayes/code/altr/lib/tags/if.js","/Users/mhayes/code/altr/lib/tags/raw.js","/Users/mhayes/code/altr/lib/altr.js","/Users/mhayes/code/altr/lib/template-string.js","/Users/mhayes/code/altr/lib/element-node.js","/Users/mhayes/code/altr/lib/merge-hooks.js","/Users/mhayes/code/altr/lib/text-node.js","/Users/mhayes/code/altr/lib/to-string.js","/Users/mhayes/code/altr/lib/altr-extend.js","/Users/mhayes/code/altr/lib/run-hooks.js","/Users/mhayes/code/altr/lib/get-element.js","/Users/mhayes/code/altr/lib/destroy.js","/Users/mhayes/code/altr/lib/remove.js","/Users/mhayes/code/altr/lib/render.js","/Users/mhayes/code/altr/lib/raf.js","/Users/mhayes/code/altr/lib/set-children.js","/Users/mhayes/code/altr/node_modules/browserify/node_modules/events/events.js","/Users/mhayes/code/altr/lib/decorators.js","/Users/mhayes/code/altr/lib/attributes.js","/Users/mhayes/code/altr/node_modules/batch-queue/index.js","/Users/mhayes/code/altr/node_modules/extend/index.js","/Users/mhayes/code/altr/node_modules/dirtybit/lib/index.js","/Users/mhayes/code/altr/node_modules/dirtybit/lib/list.js","/Users/mhayes/code/altr/node_modules/dirtybit/lib/watch.js","/Users/mhayes/code/altr/node_modules/dirtybit/lib/build.js","/Users/mhayes/code/altr/node_modules/dirtybit/lib/parse.js","/Users/mhayes/code/altr/node_modules/dirtybit/lib/expression.js","/Users/mhayes/code/altr/node_modules/dirtybit/lib/hash.js"],"names":["module","exports","global","altr","require","placeholder","childrenTag","includeTag","textTag","htmlTag","withTag","forTag","rawTag","ifTag","addTag","original","getter","lookups","update","val","nodeName","current","parentNode","replaceChild","_altrPlaceholder","this","batch","add","on","children","el","nodes","Array","isArray","filter","is_node","i","l","length","setChildren","call","innerHTML","bind","nodeType","include","set","data","content","remove","insert","initNodes","childNodes","state","scope","done","removeListeners","push","destroy","listener","pop","removeListener","text","textContent","html","accessor","getAttribute","forEach","getElementsByTagName","run","script","fixed","document","createElement","parent","attrs","attributes","setAttribute","name","value","insertBefore","removeChild","_val","Object","create","parts","split","hooks","forHandler","root","args","updateChildren","prop","items","$index","newItems","index","newChildren","removed","matched","added","domNodes","findIndex","unique","makeChild","concat","slice","flatten","runUpdates","d","indexOf","undefined","template","cloneNode","runDomUpdates","runHooks","match","forRegexp","console","error","key","mergeHooks","list","reduce","all","part","decorators","toggle","lastVal","hidden","createComment","first","show","origin","_options","options","helpers","extend","sync","tagRegExp","makeTagRegExp","delimiters","doc","domModule","dirtybit","raf","runBatch","Buffer","toString","temp","createDocumentFragment","firstChild","appendChild","rootNodes","_nodes","_lookups","join","node","initNode","prototype","Boolean","node_handlers","DOCUMENT_FRAGMENT_NODE","addHelper","helper","attr","tag","tags","tagList","constructor","appendTo","getEl","fn","addDecorator","emit","_delimiters","RegExp","EE","EventEmitter","templateString","elementNode","altrExtend","textNode","render","getElement","into","templatString","change","setPart","idx","next","remaining","createElementNode","altr_tags","lastIndexOf","createAttr","raw","createDecorators","merge","each","type","ready","initTextNode","clone","map","COMMENT_NODE","TEXT_NODE","outerHTML","base","extension","baseOptions","get","_el","Error","includes","instance","requestAnimationFrame","callback","timeout","setTimeout","webkitRequestAnimationFrame","mozRequestAnimationFrame","prev","_events","_maxListeners","isFunction","arg","isNumber","isObject","isUndefined","defaultMaxListeners","setMaxListeners","n","isNaN","TypeError","er","handler","len","listeners","arguments","apply","addListener","m","newListener","warned","trace","once","g","fired","position","splice","removeAllListeners","ret","listenerCount","emitter","createDecorator","decorator","expression","rawAttribute","altrAttribute","removeAttribute","altrProperty","Batch","jobs","queud","queue","self","queued","hasOwn","hasOwnProperty","isPlainObject","obj","setInterval","has_own_constructor","has_is_property_of_method","src","copy","copyIsArray","target","deep","ChangeDetector","expressions","List","updating","watchExpression","watch","setValue","processQueue","head","tail","ListItem","exp","watchNode","parse","detector","watchHelper","handlers","built","build","deps","Expression","compiled","check","left","id","makeVar","vars","lookup","right","statement","op","labels","middle","arr","compile","body","Function","helperNames","keys","str","cache","trim","start","end","types","cur","range","whitesapce","continueExpression","findContinuation","continuations","continuation","keyword","keywords","word","j","l2","Node","keywordValues","string","open","chr","number","decimal","parseInt","label","reservedCharacters","array","ends","group","member","unary","unaryOperators","boundary","child","presidence","binary","sortedBinaryOperators","binaryOperators","ternary","condition","ok","not","litteral","hash","rawValue","%","/","*","-","+",">>","<<",">>>","<",">","<=",">=","instanceof","in","!=","==","!==","===","&","|","^","&&","||","sort","r","dependents","passThrough","shouldUpdate","dependencies","onlyOnce","report","charCodeAt"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if (!n[o]){if (!t[o]){var a=typeof require==\"function\"&&require;if (!u&&a)return a(o,!0);if (i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for (var o=0;o<r.length;o++)s(r[o]);return s})","module.exports = global.altr = require('./index')\n","var placeholder = require('./tags/placeholder')\n  , childrenTag = require('./tags/children')\n  , includeTag = require('./tags/include')\n  , textTag = require('./tags/text')\n  , htmlTag = require('./tags/html')\n  , withTag = require('./tags/with')\n  , forTag = require('./tags/for')\n  , rawTag = require('./tags/raw')\n  , ifTag = require('./tags/if')\n  , altr = require('./altr')\n\nmodule.exports = altr\n\naltr.addTag('altr-children', childrenTag)\naltr.addTag('altr-replace', placeholder)\naltr.addTag('altr-include', includeTag)\naltr.addTag('altr-text', textTag)\naltr.addTag('altr-html', htmlTag)\naltr.addTag('altr-with', withTag)\naltr.addTag('altr-for', forTag)\naltr.addTag('altr-raw', rawTag)\naltr.addTag('altr-if', ifTag)\n","module.exports = placeholder\n\nfunction placeholder(original, getter, lookups) {\n  var current = original\n    , altr = this\n\n  this.batch.add(lookups.on(getter, update))\n\n  function update(val) {\n    if (!val || !val.nodeName || val === current) {\n      return\n    }\n\n    current.parentNode.replaceChild(val, current)\n    original._altrPlaceholder = val\n    current = val\n  }\n}\n","var setChildren = require('../set-children')\n\nmodule.exports = children\n\nfunction children(el, getter, lookups) {\n  var current = []\n\n  el.innerHTML = ''\n  this.batch.add(lookups.on(getter, update.bind(this)))\n\n  function update(val) {\n    var nodes = (Array.isArray(val) ? val : [val]).filter(is_node)\n\n    for (var i = 0, l = nodes.length; i < l; ++i) {\n      if (nodes[i] !== current[i]) {\n        break\n      }\n    }\n\n    if (i === nodes.length === current.length) {\n      return\n    }\n\n    current = nodes\n    setChildren.call(this, el, current)\n  }\n}\n\nfunction is_node(el) {\n  return el && el.nodeType\n}\n","module.exports = include\n\nfunction include(el, getter, lookups) {\n  var removeListeners = []\n  var children = null\n  var content = ''\n  var altr = this\n\n  lookups.on(getter, set)\n  lookups.on('this', update)\n\n  return {insert: insert, remove: remove, destroy: destroy}\n\n  function set(data) {\n    content = typeof data === 'string' ? data : ''\n    if (children) remove(el, insert)\n  }\n\n  function insert() {\n    if (children) {\n      return\n    }\n\n    el.innerHTML = content\n    children = altr.initNodes(el.childNodes, null, lookups.state, lookups.scope)\n  }\n\n  function remove(el, done) {\n    if (!children) {\n      return done()\n    }\n\n    if (removeListeners.push(done) > 1) {\n      return\n    }\n\n    altr.destroy(children, el, function() {\n      var listener\n\n      if (!children) {\n        el.innerHTML = ''\n      }\n\n      while(listener = removeListeners.pop()) {\n        listener()\n      }\n    })\n\n    children = null\n  }\n\n  function update(state) {\n    children && children.lookups.update(state)\n  }\n\n  function destroy() {\n    lookups.removeListener('this', update)\n    lookups.removeListener(getter, set)\n  }\n}\n","module.exports = text\n\nfunction text(el, getter, lookups) {\n  this.batch.add(lookups.on(getter, update))\n\n  function update(val) {\n    el.textContent = typeof val === 'undefined' ? '' : val\n  }\n}\n","module.exports = html\n\nfunction html(el, accessor, lookups) {\n  this.batch.add(lookups.on(accessor, update))\n\n  function update(val) {\n    el.innerHTML = typeof val === 'undefined' ? '' : val\n\n    if (el.getAttribute('altr-run-scripts')) {\n      [].forEach.call(el.getElementsByTagName('script'), run)\n    }\n  }\n}\n\nfunction run(script) {\n  var fixed = document.createElement('script')\n    , parent = script.parentNode\n    , attrs = script.attributes\n    , src\n\n  for (var i = 0, l = attrs.length; i < l; ++i) {\n    fixed.setAttribute(attrs[i].name, attrs[i].value)\n  }\n\n  fixed.textContent = script.textContent\n  parent.insertBefore(fixed, script)\n  parent.removeChild(script)\n}\n","module.exports = withTag\n\nfunction withTag(el, getter, lookups) {\n  var children = this.initNodes(el.childNodes)\n    , parts = getter.split(' as ')\n\n  lookups.on(parts[0], update)\n\n  return children.hooks\n\n  function update(_val) {\n    var val = Object.create(lookups.state)\n\n    val[parts[1]] = _val\n    children.lookups.update(val)\n  }\n}\n","var setChildren = require('../set-children')\nvar forRegexp = /^(.*?)\\s+in\\s+(.*$)/\n\nmodule.exports = forHandler\n\nfunction forHandler (root, args, lookups) {\n  var template = root.cloneNode(true)\n  var parts = args.match(forRegexp)\n  var domNodes = []\n  var children = []\n  var altr = this\n  var items = []\n\n  if (!parts) {\n    return console.error('invalid `for` tag: ' + args)\n  }\n\n  var runUpdates = altr.batch.add(runDomUpdates)\n\n  root.innerHTML = ''\n\n  var unique = parts[1].split(':')[1]\n  var prop = parts[1].split(':')[0]\n  var key = parts[2]\n\n  lookups.on(key, update)\n  lookups.on('this', updateChildren)\n\n  return altr.mergeHooks(function () {\n    return flatten(children)\n  })\n\n  function updateChildren (data) {\n    for (var i = 0, l = children.length; i < l; ++i) {\n      var scope = children[i].lookups.scope\n      scope[prop] = items[i]\n      scope.$index = i\n      children[i].lookups.update(data)\n    }\n  }\n\n  function update (newItems) {\n    var i, l\n    if (!Array.isArray(newItems)) {\n      newItems = []\n    }\n\n    var newChildren = new Array(newItems.length)\n    var removed = []\n    var matched = {}\n    var added = []\n    var index\n\n    domNodes = []\n\n    for (i = 0, l = newItems.length; i < l; ++i) {\n      index = findIndex(items, newItems[i], unique)\n\n      if (index !== -1) {\n        newChildren[i] = children[index]\n        items[index] = children[index] = matched\n      } else {\n        added.push(newChildren[i] = makeChild())\n      }\n\n      domNodes = domNodes.concat(newChildren[i].nodes)\n    }\n\n    for (i = 0, l = children.length; i < l; ++i) {\n      if (children[i] !== matched) {\n        removed.push(children[i])\n      }\n    }\n\n    children = newChildren.slice()\n    items = newItems.slice()\n    updateChildren(lookups.state)\n    altr.destroy(flatten(removed), root, runUpdates.bind(\n        altr\n      , domNodes\n      , flatten(added)\n    ))\n  }\n\n  function findIndex (items, d, unique) {\n    if (!unique) {\n      return items.indexOf(d)\n    }\n\n    for (var i = 0, l = items.length; i < l; ++i) {\n      if (items[i][unique] === d[unique]) {\n        return i\n      }\n    }\n\n    return -1\n  }\n\n  function makeChild () {\n    var scope = Object.create(lookups.scope)\n    scope.$index = undefined\n    scope[prop] = undefined\n    return altr.initNodes(template.cloneNode(true).childNodes, null, null, scope)\n  }\n\n  function runDomUpdates (children, added) {\n    setChildren.call(this, root, children)\n    altr.runHooks(added, 'insert', root)\n  }\n}\n\nfunction flatten (list) {\n  return list.reduce(function (all, part) {\n    return part.hooks ? all.concat(part.hooks) : all\n  }, [])\n}\n","module.exports = ifTag\n\nfunction ifTag (el, getter, lookups, decorators) {\n  var placeholder = this.document.createComment('altr-if-placeholder')\n  var children = this.initNodes(el.childNodes, null, null, lookups.scope)\n  var all = children.hooks.concat(decorators)\n  var lastVal = null\n  var hidden = null\n  var first = true\n  var altr = this\n\n  global.lookups = children.lookups\n\n  var update = this.batch.add(function (show, origin) {\n    if (!hidden && !show) {\n      el.parentNode.replaceChild(placeholder, el)\n      el._altrPlaceholder = placeholder\n      hidden = true\n    } else if (hidden && show) {\n      placeholder.parentNode.replaceChild(el, placeholder)\n      altr.runHooks(all, 'insert', origin)\n      delete el._altrPlaceholder\n      hidden = false\n    } else if (first) {\n      first = false\n      altr.runHooks(all, 'insert', origin)\n    }\n  })\n\n  lookups.on('[' + getter + ', this]', toggle)\n\n  return {\n    insert: insert,\n    remove: remove,\n    destroy: destroy\n  }\n\n  function destroy (el) {\n    altr.runHooks(children.hooks, 'destroy', el)\n  }\n\n  function toggle (args) {\n    lastVal = !!args[0]\n\n    if (lastVal) {\n      update(true, el)\n      children.lookups.update(args[1])\n    } else {\n      altr.remove(all, el, function () {\n        return update(false, el)\n      })\n    }\n  }\n\n  function insert (el) {\n    if (lastVal) {\n      update(true, el)\n    }\n  }\n\n  function remove (el, done) {\n    if (hidden) {\n      done()\n\n      return update(false)\n    }\n\n    altr.remove(children.hooks, el, function () {\n      update(false)\n      done()\n    })\n  }\n}\n","module.exports = function raw() {}\n","var EE = require('events').EventEmitter\nvar batch = require('batch-queue')\nvar dirtybit = require('dirtybit')\nvar extend = require('extend')\n\nvar templateString = require('./template-string')\nvar elementNode = require('./element-node')\nvar mergeHooks = require('./merge-hooks')\nvar altrExtend = require('./altr-extend')\nvar textNode = require('./text-node')\nvar toString = require('./to-string')\nvar runHooks = require('./run-hooks')\nvar getEl = require('./get-element')\nvar destroy = require('./destroy')\nvar render = require('./render')\nvar remove = require('./remove')\nvar raf = require('./raf')\n\n// dynamic require so it does not make it into the browserify bundle\nvar domModule = 'micro-dom'\n\nmodule.exports = altr\n\naltr.helpers = {}\naltr.decorators = {}\n\naltr.render = render\naltr.addTag = addTag\naltr.extend = altrExtend\naltr.addHelper = addHelper\naltr.addDecorator = addDecorator\n\nfunction altr(root, data, _options) {\n  if (!(this instanceof altr)) {\n    return new altr(root, data, _options)\n  }\n\n  var options = _options || {}\n\n  this.helpers = extend(\n      false\n    , Object.create(altr.helpers)\n    , options.helpers || {}\n  )\n\n  this.decorators = extend(\n      false\n    , Object.create(altr.decorators)\n    , options.decorators || {}\n  )\n\n  this.root = root\n  this.sync = !!options.sync\n  this.tagRegExp = makeTagRegExp(options.delimiters)\n  this.document = options.doc || global.document || require(domModule).document\n  this.lookups = dirtybit(data, {helpers: this.helpers}, {})\n\n  this.batch = batch((function() {\n    if (!this.sync) {\n      raf(this.runBatch.bind(this))\n    }\n  }).bind(this))\n\n  if (global.Buffer && root instanceof global.Buffer) {\n    root = root.toString()\n  }\n\n  if (typeof root === 'string') {\n    var temp = this.document.createElement('div')\n\n    temp.innerHTML = root\n    this.root = this.document.createDocumentFragment()\n\n    while(temp.firstChild) {\n      this.root.appendChild(temp.firstChild)\n    }\n  }\n\n  this.children = this.initNodes(this.rootNodes(), this.lookups)\n  this.runHooks(this.children.hooks, 'insert', null)\n  this.runBatch()\n}\n\naltr.prototype = Object.create(EE.prototype)\naltr.prototype.constructor = altr\n\naltr.prototype.templateString = templateString\naltr.prototype.addDecorator = addDecorator\naltr.prototype.mergeHooks = mergeHooks\naltr.prototype.initNodes = initNodes\naltr.prototype.rootNodes = rootNodes\naltr.prototype.addHelper = addHelper\naltr.prototype.runBatch = runBatch\naltr.prototype.toString = toString\naltr.prototype.runHooks = runHooks\naltr.prototype.getElement = getEl\naltr.prototype.destroy = destroy\naltr.prototype.remove = remove\naltr.prototype.into = appendTo\naltr.prototype.update = update\naltr.prototype.tagList = []\naltr.prototype.tags = {}\n\nvar node_handlers = {}\n\nnode_handlers[1] = elementNode\nnode_handlers[3] = textNode\n\nfunction update(data, sync) {\n  this.state = data\n  this.lookups.update(data)\n\n  if (sync || this.sync) {\n    this.runBatch()\n  }\n}\n\nfunction initNodes(_nodes, _lookups, state, scope) {\n  var altr = this\n  var lookups = _lookups || dirtybit(state, {helpers: this.helpers}, scope || {})\n  var nodes = Array.prototype.slice.call(_nodes)\n  var hooks = nodes.reduce(join, []).filter(Boolean)\n\n  return {hooks: hooks, lookups: lookups, nodes: nodes}\n\n  function join(list, node) {\n    var hooks = initNode.call(altr, lookups, node)\n\n    return hooks ? list.concat(hooks) : list\n  }\n}\n\nfunction initNode(lookups, el) {\n  return node_handlers[el.nodeType] ?\n    node_handlers[el.nodeType].call(this, el, lookups) :\n    el.childNodes && el.childNodes.length ?\n    this.initNodes(lookups, el.childNodes) :\n    null\n}\n\nfunction rootNodes() {\n  return this.root.nodeType === this.document.DOCUMENT_FRAGMENT_NODE ?\n    [].slice.call(this.root.childNodes) :\n    [this.root]\n}\n\nfunction addHelper(name, helper) {\n  this.helpers[name] = helper\n}\n\nfunction addTag(attr, tag) {\n  this.prototype.tags[attr] = tag\n  this.prototype.tagList.push({\n      attr: attr\n    , constructor: tag\n  })\n}\n\nfunction appendTo(node) {\n  var rootNodes = this.rootNodes()\n\n  for (var i = 0, l = rootNodes.length; i < l; ++i) {\n    node.appendChild(getEl(rootNodes[i]))\n  }\n}\n\nfunction addHelper(name, fn) {\n  return this.helpers[name] = fn\n}\n\nfunction addDecorator(name, fn) {\n  return this.decorators[name] = fn\n}\n\nfunction runBatch() {\n  this.batch.run() && this.emit('update', this.state)\n}\n\nfunction makeTagRegExp(_delimiters) {\n  var delimiters = _delimiters || ['{{', '}}']\n\n  return new RegExp(delimiters[0] + '\\\\s*(.*?)\\\\s*' + delimiters[1])\n}\n","module.exports = templatString\n\nfunction templatString(template, change, lookups) {\n  if (!template.match(this.tagRegExp)) {\n    return\n  }\n\n  var remaining = template\n    , parts = []\n    , hooks = []\n    , index\n    , next\n\n  while(remaining && (next = remaining.match(this.tagRegExp))) {\n    if (index = remaining.indexOf(next[0])) {\n      parts.push(remaining.slice(0, index))\n    }\n\n    parts.push('')\n    remaining = remaining.slice(index + next[0].length)\n    lookups.on(next[1], setPart.bind(this, parts.length - 1))\n  }\n\n  if (remaining) {\n    setPart(parts.length, remaining)\n  }\n\n  function setPart(idx, val) {\n    parts[idx] = val\n\n    change(parts.join(''))\n  }\n}\n","var createDecorators = require('./decorators')\nvar createAttr = require('./attributes')\n\nmodule.exports = createElementNode\n\nfunction createElementNode (el, lookups) {\n  var decorators = []\n  var altr = this\n  var attr\n\n  var attrs = Array.prototype.slice.call(el.attributes)\n  var altr_tags = {}\n\n  for (var i = 0, l = attrs.length; i < l; ++i) {\n    if (altr.tags[attrs[i].name]) {\n      altr_tags[attrs[i].name] = attrs[i].value\n    } else if (altr.decorators[attrs[i].name]) {\n      decorators.push(attrs[i])\n    } else if (!attrs[i].name.lastIndexOf('altr-attr-', 0)) {\n      createAttr.altr.call(this, el, attrs[i], lookups)\n    } else if (!attrs[i].name.lastIndexOf('altr-prop-', 0)) {\n      createAttr.prop.call(this, el, attrs[i], lookups)\n    } else {\n      createAttr.raw.call(this, el, attrs[i], lookups)\n    }\n  }\n\n  var hooks = createDecorators.call(altr, el, decorators, lookups)\n\n  for (var i = 0, l = altr.tagList.length; i < l; ++i) {\n    if (attr = altr_tags[altr.tagList[i].attr]) {\n      return hooks.concat([\n          altr.tagList[i].constructor.call(altr, el, attr, lookups, hooks) || {}\n      ])\n    }\n  }\n\n  return hooks.concat(altr.initNodes(el.childNodes, lookups).hooks)\n}\n","module.exports = merge\n\nfunction merge(children) {\n  var altr = this\n\n  return {\n      insert: each.bind(null, 'insert')\n    , destroy: each.bind(null, 'destroy')\n    , remove: remove\n  }\n\n  function each(type, el) {\n    var nodes = children()\n\n    for (var i = 0, l = nodes.length; i < l; i++) {\n      nodes[i][type] && nodes[i][type](el)\n    }\n  }\n\n  function remove(el, ready) {\n    altr.remove(children(), el, ready)\n  }\n}","module.exports = initTextNode\n\nfunction initTextNode(el, lookups) {\n  this.templateString(\n      el.textContent\n    , this.batch.add(update)\n    , lookups\n  )\n\n  function update(val) {\n    el.textContent = val\n  }\n}\n","module.exports = toString\n\nfunction toString() {\n  return this.rootNodes().map(function(node) {\n    switch(node.nodeType) {\n      case this.document.DOCUMENT_FRAGMENT_NODE:\n      case this.document.COMMENT_NODE: return clone.call(this, node)\n      case this.document.TEXT_NODE: return node.textContent\n      default: return node.outerHTML\n    }\n  }, this).join('')\n\n  function clone(node) {\n    var temp = this.document.createElement('div')\n\n    temp.appendChild(node.cloneNode(true))\n\n    return temp.innerHTML\n  }\n}\n","var extend = require('extend')\n\nmodule.exports = altrExtend\n\nfunction altrExtend(base, options) {\n  var baseOptions = extend(true, base, options)\n  var altr = this\n\n  extension.render = altr.render.bind(altr, baseOptions)\n  extension.extend = altr.extend.bind(altr)\n  extension.addTag = altr.addTag.bind(altr)\n  extension.include = altr.include.bind(altr)\n  extension.addHelper = altr.addHelper.bind(altr)\n  extension.addDecorator = altr.addDecorator.bind(altr)\n\n  return extension\n\n  function extension(root, state, options) {\n    return new altr(root, state, extend(\n        true\n      , Object.create(baseOptions)\n      , options || {}\n    ))\n  }\n}\n","module.exports = runHooks\n\nfunction runHooks(hooks, type, el) {\n  for (var i = 0, l = hooks.length; i < l; i++) {\n    hooks[i][type] && hooks[i][type](el)\n  }\n}\n","module.exports = get\n\nfunction get(_el) {\n  var el = _el\n\n  while(el && el._altrPlaceholder) {\n    el = el._altrPlaceholder\n\n    if (el === _el) {\n      throw new Error('placeholder circular refference')\n    }\n  }\n\n  return el\n}\n","module.exports = destroy\n\nfunction destroy(children, el, done) {\n  var altr = this\n\n  altr.remove(children, el, function(el) {\n    altr.runHooks(children, 'destroy', el)\n    done()\n  })\n}\n","module.exports = remove\n\nfunction remove(hooks, el, ready) {\n  var remaining = hooks.length\n  var c = 0\n\n  for (var i = 0, l = remaining; i < l; i++) {\n    hooks[i].remove ? hooks[i].remove(el, done) : --remaining\n  }\n\n  if (!remaining) {\n    ready()\n  }\n\n  function done() {\n    if (!--remaining) {\n      remaining = -1\n      ready()\n    }\n  }\n}","module.exports = render\n\nfunction render(template, state, el) {\n  if (this.includes[template]) {\n    template = this.includes[template]\n  }\n\n  var instance = this(template)\n\n  instance.update(state || {}, true)\n\n  if (el) {\n    instance.into(el)\n  }\n\n  return instance\n}\n","module.exports = requestAnimationFrame\n\nfunction requestAnimationFrame(callback) {\n  var raf = global.requestAnimationFrame ||\n    global.webkitRequestAnimationFrame ||\n    global.mozRequestAnimationFrame ||\n    timeout\n\n  return raf(callback)\n\n  function timeout(callback) {\n    return setTimeout(callback, 1000 / 60)\n  }\n}\n","var get = require('./get-element')\n\nmodule.exports = setChildren\n\nfunction setChildren(root, nodes) {\n  var prev = null\n    , el\n\n  for (var i = nodes.length - 1; i >= 0; --i) {\n    el = get(nodes[i])\n    root.insertBefore(el, prev)\n    prev = el\n  }\n\n  while((el = root.firstChild) !== prev) {\n    root.removeChild(el)\n  }\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      }\n      throw TypeError('Uncaught, unspecified \"error\" event.');\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        len = arguments.length;\n        args = new Array(len - 1);\n        for (i = 1; i < len; i++)\n          args[i - 1] = arguments[i];\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    len = arguments.length;\n    args = new Array(len - 1);\n    for (i = 1; i < len; i++)\n      args[i - 1] = arguments[i];\n\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    var m;\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  var ret;\n  if (!emitter._events || !emitter._events[type])\n    ret = 0;\n  else if (isFunction(emitter._events[type]))\n    ret = 1;\n  else\n    ret = emitter._events[type].length;\n  return ret;\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","module.exports = decorators\n\nfunction decorators(el, attrs, lookups) {\n  var altr = this\n  var hooks = []\n\n  return attrs.map(createDecorator)\n\n  function createDecorator(attr) {\n    var decorator = altr.decorators[attr.name].call(altr, el)\n    var expression = '[' + attr.value + ']'\n\n    if (!decorator) {\n      return\n    }\n\n    var hooks = {insert: decorator.insert, remove: decorator.remove}\n\n    if (decorator.update) {\n      lookups.on(expression, update)\n    }\n\n    hooks.destroy = destroy\n\n    return hooks\n\n    function destroy() {\n      if (decorator.update) lookups.removeListener(expression, update)\n\n      if (decorator.destroy) {\n        decorator.destroy()\n      }\n    }\n\n    function update(args) {\n      decorator.update.apply(null, args)\n    }\n  }\n}\n","module.exports.raw = rawAttribute\nmodule.exports.altr = altrAttribute\nmodule.exports.prop = altrProperty\n\nfunction rawAttribute(el, attr, lookups) {\n  this.templateString(\n      attr.value\n    , this.batch.add(el.setAttribute.bind(el, attr.name))\n    , lookups\n  )\n}\n\nfunction altrAttribute(el, attr, lookups) {\n  var name = attr.name.slice('altr-attr-'.length)\n\n  lookups.on(attr.value, this.batch.add(update))\n  el.removeAttribute(attr.name)\n\n  function update(val) {\n    if (!val && val !== '' && val !== 0) {\n      return el.removeAttribute(name)\n    }\n\n    el.setAttribute(name, val)\n  }\n}\n\nfunction altrProperty(el, attr, lookups) {\n  var name = attr.name.slice('altr-prop-'.length)\n\n  el.removeAttribute(attr.name)\n  lookups.on(attr.value, this.batch.add(update))\n\n  function update(val) {\n    el[name] = val\n  }\n}\n","module.exports = Batch\n\nfunction Batch(ready, all) {\n  if (!(this instanceof Batch)) {\n    return new Batch(ready, all)\n  }\n\n  this.jobs = []\n  this.all = all\n  this.ready = ready\n  this.queud = false\n  this.run = this.run.bind(this)\n}\n\nBatch.prototype.queue = queue\nBatch.prototype.add = add\nBatch.prototype.run = run\n\nfunction add(fn) {\n  var queued = false\n    , batch = this\n    , self\n    , args\n\n  return queue\n\n  function queue() {\n    args = [].slice.call(arguments)\n    self = this\n\n    if (queued) {\n      return batch.all && batch.ready()\n    }\n\n    queued = true\n    batch.queue(run)\n  }\n\n  function run() {\n    queued = false\n    fn.apply(self, args)\n  }\n}\n\nfunction queue(fn) {\n  this.jobs.push(fn)\n\n  if (this.all || !this.queued) {\n    this.queued = true\n    this.ready(this)\n  }\n}\n\nfunction run() {\n  var jobs = this.jobs\n\n  this.jobs = []\n  this.queued = false\n\n  for (var i = 0, l = jobs.length; i < l; ++i) {\n    jobs[i]()\n  }\n\n  return !!jobs.length\n}\n","var hasOwn = Object.prototype.hasOwnProperty;\nvar toString = Object.prototype.toString;\nvar undefined;\n\nvar isPlainObject = function isPlainObject(obj) {\n\t\"use strict\";\n\tif (!obj || toString.call(obj) !== '[object Object]' || obj.nodeType || obj.setInterval) {\n\t\treturn false;\n\t}\n\n\tvar has_own_constructor = hasOwn.call(obj, 'constructor');\n\tvar has_is_property_of_method = obj.constructor && obj.constructor.prototype && hasOwn.call(obj.constructor.prototype, 'isPrototypeOf');\n\t// Not own constructor property must be Object\n\tif (obj.constructor && !has_own_constructor && !has_is_property_of_method) {\n\t\treturn false;\n\t}\n\n\t// Own properties are enumerated firstly, so to speed up,\n\t// if last one is own, then all properties are own.\n\tvar key;\n\tfor (key in obj) {}\n\n\treturn key === undefined || hasOwn.call(obj, key);\n};\n\nmodule.exports = function extend() {\n\t\"use strict\";\n\tvar options, name, src, copy, copyIsArray, clone,\n\t\ttarget = arguments[0],\n\t\ti = 1,\n\t\tlength = arguments.length,\n\t\tdeep = false;\n\n\t// Handle a deep copy situation\n\tif (typeof target === \"boolean\") {\n\t\tdeep = target;\n\t\ttarget = arguments[1] || {};\n\t\t// skip the boolean and the target\n\t\ti = 2;\n\t} else if (typeof target !== \"object\" && typeof target !== \"function\" || target == undefined) {\n\t\t\ttarget = {};\n\t}\n\n\tfor (; i < length; ++i) {\n\t\t// Only deal with non-null/undefined values\n\t\tif ((options = arguments[i]) != null) {\n\t\t\t// Extend the base object\n\t\t\tfor (name in options) {\n\t\t\t\tsrc = target[name];\n\t\t\t\tcopy = options[name];\n\n\t\t\t\t// Prevent never-ending loop\n\t\t\t\tif (target === copy) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Recurse if we're merging plain objects or arrays\n\t\t\t\tif (deep && copy && (isPlainObject(copy) || (copyIsArray = Array.isArray(copy)))) {\n\t\t\t\t\tif (copyIsArray) {\n\t\t\t\t\t\tcopyIsArray = false;\n\t\t\t\t\t\tclone = src && Array.isArray(src) ? src : [];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tclone = src && isPlainObject(src) ? src : {};\n\t\t\t\t\t}\n\n\t\t\t\t\t// Never move original objects, clone them\n\t\t\t\t\ttarget[name] = extend(deep, clone, copy);\n\n\t\t\t\t// Don't bring in undefined values\n\t\t\t\t} else if (copy !== undefined) {\n\t\t\t\t\ttarget[name] = copy;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Return the modified object\n\treturn target;\n};\n\n","var List = require('./list.js')\nvar watch = require('./watch')\n\nmodule.exports = ChangeDetector\n\nfunction ChangeDetector (state, options, scope) {\n  if (!(this instanceof ChangeDetector)) {\n    return new ChangeDetector(state, options, scope)\n  }\n\n  this.expressions = new List()\n  this.updating = false\n  this.expressions = Object.create(null)\n  this.helpers = Object.create(null)\n  this.scope = scope || Object.create(null)\n  this.state = state\n  this.queue = []\n  this.helpers = Object.create(null)\n  this.root = this.watchExpression('this')\n}\n\nChangeDetector.prototype.watchExpression = watch\nChangeDetector.prototype.on = watch\n\nChangeDetector.prototype.update = function update (value) {\n  this.state = value\n  this.updating = true\n  this.root.setValue(value)\n  this.updating = false\n  this.processQueue()\n}\n\nChangeDetector.prototype.processQueue = function processQueue () {\n  if (this.updating) return\n  this.updating = true\n  while (this.queue.length) {\n    var queue = this.queue\n    this.queue = []\n    for (var i = 0, len = queue.length; i < len; ++i) {\n      queue[i].update(true)\n    }\n  }\n\n  this.updating = false\n}\n\n\nChangeDetector.prototype.addHelper = function addHelper (name, fn) {\n  if (typeof name !== 'string') throw new Error('Helper name must be a string')\n  if (typeof fn !== 'function') throw new Error('Helper must be a function')\n  this.helpers[name] = fn\n}\n","module.exports = List\n\nfunction List () {\n  this.head = null\n  this.tail = null\n}\n\nList.prototype.add = function add (value) {\n  if (this.tail) {\n    this.tail = this.tail.next = new ListItem(this, value, this.tail)\n  } else {\n    this.head = this.tail = new ListItem(this, value, null)\n  }\n\n  return this.tail\n}\n\nfunction ListItem (list, value, prev) {\n  this.list = list\n  this.value = value\n  this.prev = prev\n  this.next = null\n}\n\nListItem.prototype.remove = function () {\n  if (this === this.list.head) this.list.head = this.next\n  if (this === this.list.tail) this.list.tail = this.prev\n  if (this.prev) this.prev.next = this.next\n  if (this.next) this.next.prev = this.prev\n}\n","var parse = require('./parse')\nvar build = require('./build')\nvar Expression = require('./expression')\n\nmodule.exports = watch\n\nfunction watch (expression, handler) {\n  var exp = this.expressions[expression]\n\n  if (!exp) {\n    exp = watchNode(this, parse(expression), handler)\n  }\n\n  if (handler) {\n    handler(exp.value)\n  }\n\n  return exp\n}\n\nfunction watchNode (detector, node, handler) {\n  var expression\n\n  if (detector.expressions[node.value]) return detector.expressions[node.value]\n  if (node.type === 'helper') {\n    expression = watchHelper(detector, node, handler)\n  } else {\n    expression = watchExpression(detector, node)\n  }\n\n  expression.update(false)\n\n  if (handler) {\n    expression.handlers.push(handler)\n  }\n\n  return expression\n}\n\nfunction watchExpression (detector, node) {\n  var built = build(node, detector.scope)\n  var helpers = built.deps.helpers\n  var len = helpers.length\n  var deps = new Array(len)\n\n  for (var i = 0; i < len; ++i) {\n    deps[i] = watchNode(detector, built.deps.helpers[i])\n  }\n\n  if ((built.deps.data || built.deps.scope) && detector.root) {\n    deps.push(detector.root)\n  }\n\n  var expression = new Expression(detector, built.compiled, node, deps)\n\n  detector.expressions[node.value] = expression\n\n  return expression\n}\n\nfunction watchHelper (detector, node) {\n  var name = node.data.left.value\n  var constructor = detector.helpers[name]\n  if (!constructor) {\n    throw new Error('Unknown helper: ' + name)\n  }\n\n  var children = node.data.children\n  var len = children.length\n  var deps = new Array(len)\n\n  for (var i = 0; i < len; ++i) {\n    deps[i] = watchNode(detector, children[i])\n  }\n\n  var helper = constructor(change)\n\n  if (typeof helper !== 'function') {\n    throw new Error('helper ' + name + ' did not return a function')\n  }\n\n  var built = build.helper(deps.length)\n  var expression = new Expression(detector, check, node, deps)\n\n  detector.expressions[node.value] = expression\n  detector.helpers[node.id] = expression\n\n  return expression\n\n  function change (value) {\n    return expression.setValue(value)\n  }\n\n  function check () {\n    return built(helper, deps)\n  }\n}\n","module.exports = function (root, scope) {\n  var deps = {\n    id: 0,\n    helpers: {},\n    labels: {},\n    vars: [],\n    scope: false,\n    data: false\n  }\n\n  var built = build(root, deps, scope || {})\n  var helperNames = Object.keys(deps.helpers)\n  var helpers = new Array(helperNames.length)\n\n  for (var i = 0, len = helperNames.length; i < len; ++i) {\n    helpers[i] = deps.helpers[helperNames[i]]\n  }\n\n  deps.helpers = helpers\n\n  return {\n    deps: deps,\n    raw: root.value,\n    body: built,\n    compiled: compile(built, deps)\n  }\n}\n\nmodule.exports.helper = function buildHelper (len) {\n  if (!len) return new Function('update', 'update()')\n  var body = 'update('\n\n  for (var i = 0; i < len - 1; ++i) {\n    body += 'deps[' + i + '].value, '\n  }\n\n  body += 'deps[' + i + '].value)'\n\n  return new Function('update, deps', body)\n}\n\nfunction build (node, deps, scope) {\n  if (node.type === 'group') {\n    return '(' + build(node.data.expression, deps, scope) + ')'\n  }\n\n  if (node.type === 'number' || node.type === 'string' || node.type === 'keyword') {\n    return node.value\n  }\n\n  if (node.type === 'unary') {\n    return node.data.op + '(' + build(node.data.right, deps, scope) + ')'\n  }\n\n  if (node.type === 'helper') {\n    deps.helpers[node.value] = node\n    return 'helpers[\"' + node.id + '\"].value'\n  }\n\n  if (node.type === 'label') {\n    var type = node.value in scope ? 'scope' : 'data'\n    deps[type] = true\n    if (node.value === 'this') return 'data'\n    if (deps.labels[node.value]) return deps.labels[node.value]\n    var id = deps.labels[node.value] = lookup(type, '\"' + node.value + '\"')\n    return id\n  }\n\n  if (node.type === 'member') {\n    return lookup(makeVar(node.data.left), '\"' + node.data.right.value + '\"')\n  }\n\n  if (node.type === 'index') {\n    return lookup(makeVar(node.data.left), makeVar(node.data.right))\n  }\n\n  if (node.type === 'binary') {\n    return build(node.data.left, deps, scope) + ' ' +\n      node.data.op + ' ' + build(node.data.right, deps, scope)\n  }\n\n  if (node.type === 'ternary') {\n    return build(node.data.left, deps, scope) + ' ? ' +\n      build(node.data.middle, deps, scope) + ' : ' +\n      build(node.data.right, scope)\n  }\n\n  if (node.type === 'array') {\n    var arr = '['\n\n    for (var i = 0, l = node.data.children.length - 1; i < l; ++i) {\n      arr = arr + build(node.data.children[i], deps, scope) + ', '\n    }\n\n    return arr + build(node.data.children[i], deps, scope) + ']'\n  }\n\n  function makeVar (node) {\n    if (node.type === 'member' || node.type === 'index' || node.type === 'label') {\n      return build(node, deps, scope)\n    }\n\n    var id = '_' + deps.id++\n    deps.vars.push('var ' + id + ' = ' + build(node, deps, scope))\n    return id\n  }\n\n  function lookup (left, right) {\n    var id = '_' + deps.id++\n    var statement = 'var ' + id + ' = ' + left + '!==null && ' + left +\n      ' !== undefined ? ' + left + '[' + right + '] : undefined'\n\n    deps.vars.push(statement)\n    return id\n  }\n}\n\nfunction compile (raw, deps) {\n  var body = ''\n\n  if (deps.helpers.length) {\n    body = '  var helpers = this.detector.helpers\\n' + body\n  }\n\n  if (deps.data) {\n    body = '  var data = this.detector.state\\n' + body\n  }\n\n  if (deps.scope) {\n    body = '  var scope = this.detector.scope\\n' + body\n  }\n\n  for (var i = 0, len = deps.vars.length; i < len; ++i) {\n    body += '  ' + deps.vars[i] + '\\n'\n  }\n\n  body += '  this.setValue(' + raw + ')'\n\n  return new Function('', body)\n}\n","var hash = require('./hash')\n\nvar types = [group, array, keyword, number, string, label, unary]\nvar continuations = [helper, member, index, binary, ternary]\nvar keywords = ['true', 'false', 'null', 'undefined']\nvar keywordValues = [true, false, null, undefined]\nvar unaryOperators = ['!', '+', '-', '~', 'void', 'instanceof']\nvar whitesapce = ' \\xA0\\uFEFF\\f\\n\\r\\t\\v\\u00a0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000'.split('')\nvar reservedCharacters = whitesapce.concat('(){}[]|&^=><+-*%/\\\\!@#\\'\"~.,?:`'.split(''))\nvar boundary = whitesapce.concat(['('])\nvar binaryOperators = {\n  '%': 5,\n  '/': 5,\n  '*': 5,\n  '-': 6,\n  '+': 6,\n  '>>': 7,\n  '<<': 7,\n  '>>>': 7,\n  '<': 8,\n  '>': 8,\n  '<=': 8,\n  '>=': 8,\n  instanceof: 8,\n  in: 8,\n  '!=': 9,\n  '==': 9,\n  '!==': 9,\n  '===': 9,\n  '&': 10,\n  '|': 11,\n  '^': 12,\n  '&&': 13,\n  '||': 14\n}\n\nvar sortedBinaryOperators = Object.keys(binaryOperators).sort(function (l, r) {\n  return l.length < r.length ? 1 : -1\n})\n\nmodule.exports = parse\n\nvar cache = module.exports.cache = {}\n\nfunction parse (str) {\n  return cache[str] || (cache[str] = trim(str, expression, 0))\n}\n\nfunction expression (str, start, end) {\n  if (!str || !str[start]) return null\n  for (var i = 0, l = types.length; i < l; ++i) {\n    var node = types[i](str, start, end)\n    if (node) break\n  }\n\n  if (!node) {\n    throw new Error(\n      'Unexpected token: ' + str[start] + ' in \"' + str.slice(start, 20) + '\"'\n    )\n  }\n\n  var cur = node.range[1]\n  while (whitesapce.indexOf(str[cur]) !== -1) cur = cur + 1\n\n  return end.indexOf(str[cur]) !== -1 ? node : continueExpression(str, node, end)\n}\n\nfunction continueExpression (str, node, end) {\n  var start = node.range[1]\n  while (str[start] && end.indexOf(str[start]) === -1) {\n    node = trim(str, findContinuation, start, end)\n    start = node.range[1]\n    while (whitesapce.indexOf(str[start]) !== -1) start = start + 1\n  }\n\n  if (end.indexOf(str[start]) === -1) {\n    throw new Error(\n      'Expected to find token: ' + end\n    )\n  }\n\n  return node\n\n  function findContinuation (str, start, end) {\n    for (var i = 0, l = continuations.length; i < l; ++i) {\n      var continuation = continuations[i](node, str, start, end)\n      if (continuation) break\n    }\n\n    if (!continuation) {\n      throw new Error(\n        'Unexpected token: ' + str[start] + ' in \"' + str.slice(start, start + 20) + '\"'\n      )\n    }\n\n    return continuation\n  }\n}\n\nfunction keyword (str, start) {\n  for (var i = 0, l = keywords.length; i < l; ++i) {\n    var word = keywords[i]\n    for (var j = 0, l2 = word.length; j < l2; ++j) {\n      if (str[start + j] !== word[j]) break\n    }\n\n    if (j === l2) break\n  }\n\n  if (i === l) return null\n\n  return new Node(\n    'keyword',\n    [start, start + word.length],\n    str,\n    null,\n    true,\n    keywordValues[word]\n  )\n}\n\nfunction string (str, start) {\n  var open = str[start]\n  if (open !== '\"' && open !== '\\'') return null\n  var cur = start + 1\n  var chr = str[cur]\n  while ((chr) && chr !== open) {\n    if (str === '\\\\') ++cur\n    cur = cur + 1\n    chr = str[cur]\n  }\n\n  if (str[cur++] !== open) throw new Error('Expected string to be closed')\n  return new Node(\n    'string',\n    [start, cur],\n    str,\n    null,\n    true,\n    str.slice(start + 1, cur - 1)\n  )\n}\n\nfunction number (str, start) {\n  var decimal = false\n  var cur = start\n  var chr = str[cur]\n  while (chr) {\n    if (chr === '.') {\n      if (decimal) break\n      decimal = true\n    } else if (chr < '0' || chr > '9') break\n    cur = cur + 1\n    chr = str[cur]\n  }\n\n  return cur - start ? new Node(\n    'number',\n    [start, cur],\n    str,\n    null,\n    true,\n    parseInt(str.slice(start, cur), 10)\n  ) : null\n}\n\nfunction label (str, start) {\n  var chr = str[start]\n  if (chr < 0 || chr > 9 || reservedCharacters.indexOf(chr) !== -1) return null\n  var cur = start + 1\n  chr = str[cur]\n\n  while (chr) {\n    if (reservedCharacters.indexOf(chr) !== -1) break\n    cur = cur + 1\n    chr = str[cur]\n  }\n\n  return new Node('label', [start, cur], str, null)\n}\n\nfunction array (str, start) {\n  if (str[start] !== '[') return null\n  var cur = start + 1\n  var children = []\n  var ends = [',', ']']\n  var next = trim(str, expression, cur, ends)\n  while (next) {\n    children.push(next)\n    cur = next.range[1]\n    while (ends.indexOf(str[cur]) === -1) cur = cur + 1\n    if (str[cur] === ']') break\n    cur = cur + 1\n    next = trim(str, expression, cur, ends)\n  }\n\n  return new Node('array', [start, cur + 1], str, {\n    children: children\n  })\n}\n\nfunction group (str, start) {\n  if (str[start] !== '(') return null\n\n  var node = trim(str, expression, start + 1, [')'])\n  var end = node.range[1]\n  while (whitesapce.indexOf(str[end]) !== -1) end = end + 1\n  return new Node('group', [start, end + 1], str, {\n    expression: node\n  })\n}\n\nfunction helper (left, str, start, end) {\n  if (left.type !== 'label' || str[start] !== '(') return\n  var cur = start + 1\n  var children = []\n  var ends = [',', ')']\n  var next = trim(str, expression, cur, ends)\n  while (next) {\n    children.push(next)\n    cur = next.range[1]\n    while (ends.indexOf(str[cur]) === -1) cur = cur + 1\n    if (str[cur] === ')') break\n    cur = cur + 1\n    next = trim(str, expression, cur, ends)\n  }\n\n  cur = cur + 1\n\n  return new Node('helper', [left.range[0], cur], str, {\n    left: left,\n    children: children\n  })\n}\n\nfunction member (left, str, start) {\n  if (str[start] !== '.') return null\n  var node = label(str, start + 1)\n\n  if (!node) throw new Error('Expected Label')\n  return new Node('member', [left.range[0], node.range[1]], str, {\n    left: left,\n    right: node\n  })\n}\n\nfunction index (left, str, start) {\n  if (str[start] !== '[') return null\n  var node = trim(str, expression, start + 1, [']'])\n  var end = node.range[1] + 1\n  while (whitesapce.indexOf(str[end]) !== -1) end = end + 1\n  return new Node('index', [left.range[0], end], str, {\n    left: left,\n    right: node\n  })\n}\n\nfunction unary (str, start, end) {\n  for (var i = 0, l = unaryOperators.length; i < l; ++i) {\n    var op = unaryOperators[i]\n    for (var j = 0, l2 = op.length; j < l2; ++j) {\n      if (str[start + j] !== op[j]) break\n    }\n\n    if (j === l2) break\n  }\n\n  if (i === l) return null\n  var len = op.length\n  var next = str[start + len]\n  if (len > 1 && boundary.indexOf(next) === '-1') return null\n  var child = trim(str, expression, start + len, end)\n  var node = new Node('unary', [start, child.range[1]], str, {\n    op: op,\n    right: child,\n    presidence: 4\n  })\n\n  if (child.presidence && child.presidence > 4) {\n    node.right = child.left\n    child.left = node\n    return child\n  }\n\n  return node\n}\n\nfunction binary (left, str, start, end) {\n  for (var i = 0, l = sortedBinaryOperators.length; i < l; ++i) {\n    var op = sortedBinaryOperators[i]\n    for (var j = 0, l2 = op.length; j < l2; ++j) {\n      if (str[start + j] !== op[j]) break\n    }\n\n    if (j === l2) break\n  }\n\n  if (i === l) return null\n  if (op === 'in' || op === 'instanceof') {\n    var next = str[start + op.length]\n    if (boundary.indexOf(next) === -1) return null\n  }\n\n  var presidence = binaryOperators[op]\n  var right = trim(str, expression, start + op.length, end)\n  var node = new Node('binary', [left.range[0], right.range[1]], str, {\n    op: op,\n    left: left,\n    right: right,\n    presidence: presidence\n  })\n\n  if (right.presidence && right.presidence >= presidence) {\n    node.right = right.left\n    right.left = node\n    return right\n  }\n\n  return node\n}\n\nfunction ternary (condition, str, start, end) {\n  if (str[start] !== '?') return null\n  var ok = trim(str, expression, start + 1, [':'])\n  if (!ok) throw new Error('Expected token: \":\"')\n  var next = ok.range[1] + 1\n  while (whitesapce.indexOf(str[next]) !== -1) next = next + 1\n  var not = trim(str, expression, next + 1, end)\n\n  return new Node('ternary', [condition.range[0], not.range[1]], str, {\n    left: condition,\n    middle: ok,\n    right: not,\n    presidence: 15\n  })\n}\n\nfunction trim (str, parse, start, end) {\n  var chr = str[start]\n  while (chr) {\n    if (whitesapce.indexOf(chr) === -1) break\n    start = start + 1\n    chr = str[start]\n  }\n\n  return parse(str, start, end || [undefined])\n}\n\nfunction Node (type, range, str, data, litteral, val) {\n  this.type = type\n  this.range = range\n  this.value = str.slice(range[0], range[1])\n  this.id = '_' + hash(this.value)\n  this.data = data\n  this.litteral = !!litteral\n  this.rawValue = val\n}\n","var List = require('./list')\n\nmodule.exports = Expression\n\nfunction Expression (detector, check, node, deps) {\n  this.dependents = new List()\n  this.detector = detector\n  this.check = check || passThrough\n  this.value = void 0\n  this.shouldUpdate = false\n  this.node = node\n  this.dependencies = new Array(deps.length)\n  this.handlers = []\n\n  for (var i = 0, len = deps.length; i < len; ++i) {\n    this.dependencies[i] = deps[i].dependents.add(this)\n  }\n}\n\nExpression.prototype.update = function update (onlyOnce) {\n  if (onlyOnce && !this.shouldUpdate) return\n  this.shouldUpdate = false\n  this.check()\n}\n\nExpression.prototype.setValue = function setValue (value) {\n  if (value === this.value && (!value || typeof value !== 'object')) {\n    return\n  }\n\n  this.value = value\n  this.report()\n\n  if (!this.dependents.head) return\n\n  var current = this.dependents.head\n  while (current) {\n    var expression = current.value\n    if (!this.detector.updating) {\n      expression.update(false)\n    } else {\n      expression.shouldUpdate = true\n      this.detector.queue.push(expression)\n    }\n\n    current = current.next\n  }\n}\n\nExpression.prototype.report = function report () {\n  var handlers = this.handlers\n  var len = this.handlers.length\n  var val = this.value\n\n  for (var i = 0; i < len; ++i) {\n    handlers[i](val)\n  }\n}\n\nExpression.prototype.lookup = function lookup (obj, key) {\n  return obj === null || obj === undefined ? undefined : obj[key]\n}\n\nfunction passThrough (value) {\n  return value\n}\n","module.exports = hash\n\nfunction hash (str) {\n  var i, chr, len\n  var hash = 0\n  if (str.length === 0) return hash\n  for (i = 0, len = str.length; i < len; i++) {\n    chr = str.charCodeAt(i)\n    hash = ((hash << 5) - hash) + chr\n    hash |= 0\n  }\n\n  return hash\n}\n"]}