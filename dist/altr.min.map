{"version":3,"file":"bundle.js","sources":["/Users/mhayes/code/altr/node_modules/browserify/node_modules/browser-pack/_prelude.js","/Users/mhayes/code/altr/lib/browser.js","/Users/mhayes/code/altr/lib/index.js","/Users/mhayes/code/altr/lib/tags/placeholder.js","/Users/mhayes/code/altr/lib/tags/children.js","/Users/mhayes/code/altr/lib/tags/include.js","/Users/mhayes/code/altr/lib/tags/text.js","/Users/mhayes/code/altr/lib/tags/html.js","/Users/mhayes/code/altr/lib/tags/with.js","/Users/mhayes/code/altr/lib/tags/for.js","/Users/mhayes/code/altr/lib/tags/raw.js","/Users/mhayes/code/altr/lib/tags/if.js","/Users/mhayes/code/altr/lib/altr.js","/Users/mhayes/code/altr/lib/template-string.js","/Users/mhayes/code/altr/lib/element-node.js","/Users/mhayes/code/altr/lib/merge-hooks.js","/Users/mhayes/code/altr/lib/altr-extend.js","/Users/mhayes/code/altr/lib/text-node.js","/Users/mhayes/code/altr/lib/to-string.js","/Users/mhayes/code/altr/lib/run-hooks.js","/Users/mhayes/code/altr/lib/get-element.js","/Users/mhayes/code/altr/lib/destroy.js","/Users/mhayes/code/altr/lib/render.js","/Users/mhayes/code/altr/lib/remove.js","/Users/mhayes/code/altr/lib/raf.js","/Users/mhayes/code/altr/lib/set-children.js","/Users/mhayes/code/altr/node_modules/browserify/node_modules/events/events.js","/Users/mhayes/code/altr/lib/decorators.js","/Users/mhayes/code/altr/lib/attributes.js","/Users/mhayes/code/altr/node_modules/batch-queue/index.js","/Users/mhayes/code/altr/node_modules/extend/index.js","/Users/mhayes/code/altr/node_modules/dirtybit/lib/index.js","/Users/mhayes/code/altr/node_modules/dirtybit/lib/expression.js","/Users/mhayes/code/altr/node_modules/dirtybit/lib/remove.js","/Users/mhayes/code/altr/node_modules/dirtybit/lib/parse.js","/Users/mhayes/code/altr/node_modules/dirtybit/lib/watch.js","/Users/mhayes/code/altr/node_modules/dirtybit/lib/build.js"],"names":["module","exports","global","altr","require","placeholder","childrenTag","includeTag","textTag","htmlTag","withTag","forTag","rawTag","ifTag","addTag","original","getter","lookups","update","val","nodeName","current","parentNode","replaceChild","_altrPlaceholder","this","batch","add","on","children","el","nodes","Array","isArray","filter","is_node","i","l","length","setChildren","call","innerHTML","bind","nodeType","include","set","data","content","remove","insert","initNodes","childNodes","state","done","removeListeners","push","destroy","listener","pop","removeListener","text","textContent","html","accessor","getAttribute","forEach","getElementsByTagName","run","script","fixed","document","createElement","parent","attrs","attributes","setAttribute","name","value","insertBefore","removeChild","_val","Object","create","parts","split","hooks","forHandler","root","args","updateChildren","itemData","prop","items","$index","newItems","index","newChildren","removed","matched","added","domNodes","findIndex","unique","makeChild","concat","slice","flatten","runUpdates","d","indexOf","template","cloneNode","runDomUpdates","runHooks","match","forRegexp","console","error","key","mergeHooks","list","reduce","all","part","decorators","toggle","lastVal","hidden","createComment","first","show","origin","_options","options","helpers","extend","sync","tagRegExp","makeTagRegExp","delimiters","doc","domModule","dirtybit","raf","runBatch","Buffer","toString","temp","createDocumentFragment","firstChild","appendChild","rootNodes","_nodes","_lookups","join","node","initNode","prototype","Boolean","node_handlers","DOCUMENT_FRAGMENT_NODE","addHelper","helper","attr","tag","tags","tagList","constructor","appendTo","getEl","fn","addDecorator","emit","_delimiters","RegExp","EE","EventEmitter","templateString","elementNode","altrExtend","textNode","render","getElement","into","templatString","change","setPart","idx","next","remaining","createElementNode","altr_tags","lastIndexOf","createAttr","raw","createDecorators","merge","each","type","ready","base","extension","baseOptions","initTextNode","clone","map","COMMENT_NODE","TEXT_NODE","outerHTML","get","_el","Error","includes","instance","requestAnimationFrame","callback","timeout","setTimeout","webkitRequestAnimationFrame","mozRequestAnimationFrame","prev","_events","_maxListeners","undefined","isFunction","arg","isNumber","isObject","isUndefined","defaultMaxListeners","setMaxListeners","n","isNaN","TypeError","er","handler","len","listeners","arguments","apply","addListener","m","newListener","warned","trace","once","g","fired","position","splice","removeAllListeners","ret","listenerCount","emitter","createDecorator","decorator","expression","rawAttribute","altrAttribute","removeAttribute","altrProperty","Batch","jobs","queud","queue","self","queued","hasOwn","hasOwnProperty","isPlainObject","obj","setInterval","has_own_constructor","has_is_property_of_method","src","copy","copyIsArray","target","deep","DirtyBit","values","watched","expressions","handlers","always","updating","rootKey","rootExpression","Expression","removable","report","keys","j","l2","changed","lookup","exp","watch","parse","parsed","dependents","deps","depValues","setValue","addDep","dep","_lookup","seen","removeExpression","str","trim","start","end","types","cur","range","whitesapce","continueExpression","findContinuation","continuations","continuation","keyword","keywords","word","Node","keywordValues","string","open","chr","number","decimal","parseInt","label","reservedCharacters","array","ends","group","left","member","right","unary","unaryOperators","op","boundary","child","presidence","binary","sortedBinaryOperators","binaryOperators","ternary","condition","ok","not","middle","litteral","rawValue","%","/","*","-","+",">>","<<",">>>","<",">","<=",">=","instanceof","in","!=","==","!==","===","&","|","^","&&","||","sort","r","Parser","watchNode","addLabel","addExpression","built","build","updateExpression","compiled","addDeps","body","newDeps","allDeps","compile","Function"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","module.exports = global.altr = require('./index')\n","var placeholder = require('./tags/placeholder')\n  , childrenTag = require('./tags/children')\n  , includeTag = require('./tags/include')\n  , textTag = require('./tags/text')\n  , htmlTag = require('./tags/html')\n  , withTag = require('./tags/with')\n  , forTag = require('./tags/for')\n  , rawTag = require('./tags/raw')\n  , ifTag = require('./tags/if')\n  , altr = require('./altr')\n\nmodule.exports = altr\n\naltr.addTag('altr-children', childrenTag)\naltr.addTag('altr-replace', placeholder)\naltr.addTag('altr-include', includeTag)\naltr.addTag('altr-text', textTag)\naltr.addTag('altr-html', htmlTag)\naltr.addTag('altr-with', withTag)\naltr.addTag('altr-for', forTag)\naltr.addTag('altr-raw', rawTag)\naltr.addTag('altr-if', ifTag)\n","module.exports = placeholder\n\nfunction placeholder(original, getter, lookups) {\n  var current = original\n    , altr = this\n\n  this.batch.add(lookups.on(getter, update))\n\n  function update(val) {\n    if(!val || !val.nodeName || val === current) {\n      return\n    }\n\n    current.parentNode.replaceChild(val, current)\n    original._altrPlaceholder = val\n    current = val\n  }\n}\n","var setChildren = require('../set-children')\n\nmodule.exports = children\n\nfunction children(el, getter, lookups) {\n  var current = []\n\n  el.innerHTML = ''\n  this.batch.add(lookups.on(getter, update.bind(this)))\n\n  function update(val) {\n    var nodes = (Array.isArray(val) ? val : [val]).filter(is_node)\n\n    for(var i = 0, l = nodes.length; i < l; ++i) {\n      if(nodes[i] !== current[i]) {\n        break\n      }\n    }\n\n    if(i === nodes.length === current.length) {\n      return\n    }\n\n    current = nodes\n    setChildren.call(this, el, current)\n  }\n}\n\nfunction is_node(el) {\n  return el && el.nodeType\n}\n","module.exports = include\n\nfunction include(el, getter, lookups) {\n  var removeListeners = []\n  var children = null\n  var content = ''\n  var altr = this\n\n  lookups.on(getter, set)\n  lookups.on('this', update)\n\n  return {insert: insert, remove: remove, destroy: destroy}\n\n  function set(data) {\n    content = typeof data === 'string' ? data : ''\n    if(children) remove(el, insert)\n  }\n\n  function insert() {\n    if(children) {\n      return\n    }\n\n    el.innerHTML = content\n    children = altr.initNodes(el.childNodes, null, lookups.state)\n  }\n\n  function remove(el, done) {\n    if(!children) {\n      return done()\n    }\n\n    if(removeListeners.push(done) > 1) {\n      return\n    }\n\n    altr.destroy(children, el, function() {\n      var listener\n\n      if(!children) {\n        el.innerHTML = ''\n      }\n\n      while(listener = removeListeners.pop()) {\n        listener()\n      }\n    })\n\n    children = null\n  }\n\n  function update(state) {\n    children && children.lookups.update(state)\n  }\n\n  function destroy() {\n    lookups.removeListener('this', update)\n    lookups.removeListener(getter, set)\n  }\n}\n","module.exports = text\n\nfunction text(el, getter, lookups) {\n  this.batch.add(lookups.on(getter, update))\n\n  function update(val) {\n    el.textContent = typeof val === 'undefined' ? '' : val\n  }\n}\n","module.exports = html\n\nfunction html(el, accessor, lookups) {\n  this.batch.add(lookups.on(accessor, update))\n\n  function update(val) {\n    el.innerHTML = typeof val === 'undefined' ? '' : val\n\n    if(el.getAttribute('altr-run-scripts')) {\n      [].forEach.call(el.getElementsByTagName('script'), run)\n    }\n  }\n}\n\nfunction run(script) {\n  var fixed = document.createElement('script')\n    , parent = script.parentNode\n    , attrs = script.attributes\n    , src\n\n  for(var i = 0, l = attrs.length; i < l; ++i) {\n    fixed.setAttribute(attrs[i].name, attrs[i].value)\n  }\n\n  fixed.textContent = script.textContent\n  parent.insertBefore(fixed, script)\n  parent.removeChild(script)\n}\n","module.exports = withTag\n\nfunction withTag(el, getter, lookups) {\n  var children = this.initNodes(el.childNodes)\n    , parts = getter.split(' as ')\n\n  lookups.on(parts[0], update)\n\n  return children.hooks\n\n  function update(_val) {\n    var val = Object.create(lookups.state)\n\n    val[parts[1]] = _val\n    children.lookups.update(val)\n  }\n}\n","var setChildren = require('../set-children')\nvar forRegexp = /^(.*?)\\s+in\\s+(.*$)/\n\nmodule.exports = forHandler\n\nfunction forHandler(root, args, lookups) {\n  var template = root.cloneNode(true)\n  var parts = args.match(forRegexp)\n  var domNodes = []\n  var children = []\n  var altr = this\n  var items = []\n\n  if(!parts) {\n    return console.error('invalid `for` tag: ' + args)\n  }\n\n  var runUpdates = altr.batch.add(runDomUpdates)\n\n  root.innerHTML = ''\n\n  var unique = parts[1].split(':')[1]\n  var prop = parts[1].split(':')[0]\n  var key = parts[2]\n\n\n  lookups.on(key, update)\n  lookups.on('this', updateChildren)\n\n  return altr.mergeHooks(function() {\n    return flatten(children)\n  })\n\n  function updateChildren(data) {\n    var itemData\n\n    for(var i = 0, l = children.length; i < l; ++i) {\n      itemData = typeof data === 'object' ? Object.create(data) : {}\n      itemData[prop] = items[i]\n      itemData.$index = i\n      children[i].lookups.update(itemData)\n    }\n  }\n\n  function update(newItems) {\n    if(!Array.isArray(newItems)) {\n      newItems = []\n    }\n\n    var newChildren = new Array(newItems.length)\n    var removed = []\n    var matched = {}\n    var added = []\n    var index\n\n    domNodes = []\n\n    for(var i = 0, l = newItems.length; i < l; ++i) {\n      index = findIndex(items, newItems[i], unique)\n\n      if(index !== -1) {\n        newChildren[i] = children[index]\n        items[index] = children[index] = matched\n      } else {\n        added.push(newChildren[i] = makeChild())\n      }\n\n      domNodes = domNodes.concat(newChildren[i].nodes)\n    }\n\n    for(var i = 0, l = children.length; i < l; ++i) {\n      if(children[i] !== matched) {\n        removed.push(children[i])\n      }\n    }\n\n    children = newChildren.slice()\n    items = newItems.slice()\n    updateChildren(lookups.state)\n    altr.destroy(flatten(removed), root, runUpdates.bind(\n        altr\n      , domNodes\n      , flatten(added)\n    ))\n  }\n\n  function findIndex(items, d, unique) {\n    if(!unique) {\n      return items.indexOf(d)\n    }\n\n    for(var i = 0, l = items.length; i < l; ++i) {\n      if(items[i][unique] === d[unique]) {\n        return i\n      }\n    }\n\n    return -1\n  }\n\n  function makeChild() {\n    return altr.initNodes(template.cloneNode(true).childNodes)\n  }\n\n  function runDomUpdates(children, added) {\n    setChildren.call(this, root, children)\n    altr.runHooks(added, 'insert', root)\n  }\n}\n\nfunction flatten(list) {\n  return list.reduce(function(all, part) {\n    return part.hooks ? all.concat(part.hooks) : all\n  }, [])\n}\n","module.exports = function raw() {}\n","module.exports = ifTag\n\nfunction ifTag(el, getter, lookups, decorators) {\n  var placeholder = this.document.createComment('altr-if-placeholder')\n  var children = this.initNodes(el.childNodes)\n  var all = children.hooks.concat(decorators)\n  var lastVal = null\n  var hidden = null\n  var first = true\n  var altr = this\n\n  var update = this.batch.add(function(show, origin) {\n    if(!hidden && !show) {\n      el.parentNode.replaceChild(placeholder, el)\n      el._altrPlaceholder = placeholder\n      hidden = true\n    } else if(hidden && show) {\n      placeholder.parentNode.replaceChild(el, placeholder)\n      altr.runHooks(all, 'insert', origin)\n      delete el._altrPlaceholder\n      hidden = false\n    } else if(first) {\n      first = false\n      altr.runHooks(all, 'insert', origin)\n    }\n  })\n\n  lookups.on(getter, toggle, true)\n\n  return {\n      insert: insert\n    , remove: remove\n    , destroy: destroy\n  }\n\n  function destroy(el) {\n    altr.runHooks(children.hooks, 'destroy', el)\n  }\n\n  function toggle(val) {\n    lastVal = val\n\n    if(val) {\n      update(true, el)\n      children.lookups.update(lookups.state)\n    } else {\n      altr.remove(all, el, function() {\n        return update(false, el)\n      })\n    }\n  }\n\n  function insert(el) {\n    if(lastVal) {\n      update(true, el)\n    }\n  }\n\n  function remove(el, done) {\n    if(hidden) {\n      done()\n\n      return update(false)\n    }\n\n    altr.remove(children.hooks, el, function() {\n      update(false)\n      done()\n    })\n  }\n}\n","var EE = require('events').EventEmitter\nvar batch = require('batch-queue')\nvar dirtybit = require('dirtybit')\nvar extend = require('extend')\n\nvar templateString = require('./template-string')\nvar elementNode = require('./element-node')\nvar mergeHooks = require('./merge-hooks')\nvar altrExtend = require('./altr-extend')\nvar textNode = require('./text-node')\nvar toString = require('./to-string')\nvar runHooks = require('./run-hooks')\nvar getEl = require('./get-element')\nvar destroy = require('./destroy')\nvar render = require('./render')\nvar remove = require('./remove')\nvar raf = require('./raf')\n\n// dynamic require so it does not make it into the browserify bundle\nvar domModule = 'micro-dom'\n\nmodule.exports = altr\n\naltr.helpers = {}\naltr.decorators = {}\n\naltr.render = render\naltr.addTag = addTag\naltr.extend = altrExtend\naltr.addHelper = addHelper\naltr.addDecorator = addDecorator\n\nfunction altr(root, data, _options) {\n  if(!(this instanceof altr)) {\n    return new altr(root, data, _options)\n  }\n\n  var options = _options || {}\n\n  this.helpers = extend(\n      false\n    , Object.create(altr.helpers)\n    , options.helpers || {}\n  )\n\n  this.decorators = extend(\n      false\n    , Object.create(altr.decorators)\n    , options.decorators || {}\n  )\n\n  this.root = root\n  this.sync = !!options.sync\n  this.tagRegExp = makeTagRegExp(options.delimiters)\n  this.document = options.doc || global.document || require(domModule).document\n  this.lookups = dirtybit(data, {helpers: this.helpers})\n\n  this.batch = batch((function() {\n    if(!this.sync) {\n      raf(this.runBatch.bind(this))\n    }\n  }).bind(this))\n\n  if(global.Buffer && root instanceof global.Buffer) {\n    root = root.toString()\n  }\n\n  if(typeof root === 'string') {\n    var temp = this.document.createElement('div')\n\n    temp.innerHTML = root\n    this.root = this.document.createDocumentFragment()\n\n    while(temp.firstChild) {\n      this.root.appendChild(temp.firstChild)\n    }\n  }\n\n  this.children = this.initNodes(this.rootNodes(), this.lookups)\n  this.runHooks(this.children.hooks, 'insert', null)\n  this.runBatch()\n}\n\naltr.prototype = Object.create(EE.prototype)\naltr.prototype.constructor = altr\n\naltr.prototype.templateString = templateString\naltr.prototype.addDecorator = addDecorator\naltr.prototype.mergeHooks = mergeHooks\naltr.prototype.initNodes = initNodes\naltr.prototype.rootNodes = rootNodes\naltr.prototype.addHelper = addHelper\naltr.prototype.runBatch = runBatch\naltr.prototype.toString = toString\naltr.prototype.runHooks = runHooks\naltr.prototype.getElement = getEl\naltr.prototype.destroy = destroy\naltr.prototype.remove = remove\naltr.prototype.into = appendTo\naltr.prototype.update = update\naltr.prototype.tagList = []\naltr.prototype.tags = {}\n\nvar node_handlers = {}\n\nnode_handlers[1] = elementNode\nnode_handlers[3] = textNode\n\nfunction update(data, sync) {\n  this.state = data\n  this.lookups.update(data)\n\n  if(sync || this.sync) {\n    this.runBatch()\n  }\n}\n\nfunction initNodes(_nodes, _lookups, state) {\n  var altr = this\n  var lookups = _lookups || dirtybit(state, {helpers: this.helpers})\n  var nodes = Array.prototype.slice.call(_nodes)\n  var hooks = nodes.reduce(join, []).filter(Boolean)\n\n  return {hooks: hooks, lookups: lookups, nodes: nodes}\n\n  function join(list, node) {\n    var hooks = initNode.call(altr, lookups, node)\n\n    return hooks ? list.concat(hooks) : list\n  }\n}\n\nfunction initNode(lookups, el) {\n  return node_handlers[el.nodeType] ?\n    node_handlers[el.nodeType].call(this, el, lookups) :\n    el.childNodes && el.childNodes.length ?\n    this.initNodes(lookups, el.childNodes) :\n    null\n}\n\nfunction rootNodes() {\n  return this.root.nodeType === this.document.DOCUMENT_FRAGMENT_NODE ?\n    [].slice.call(this.root.childNodes) :\n    [this.root]\n}\n\nfunction addHelper(name, helper) {\n  this.helpers[name] = helper\n}\n\nfunction addTag(attr, tag) {\n  this.prototype.tags[attr] = tag\n  this.prototype.tagList.push({\n      attr: attr\n    , constructor: tag\n  })\n}\n\nfunction appendTo(node) {\n  var rootNodes = this.rootNodes()\n\n  for(var i = 0, l = rootNodes.length; i < l; ++i) {\n    node.appendChild(getEl(rootNodes[i]))\n  }\n}\n\nfunction addHelper(name, fn) {\n  return this.helpers[name] = fn\n}\n\nfunction addDecorator(name, fn) {\n  return this.decorators[name] = fn\n}\n\nfunction runBatch() {\n  this.batch.run() && this.emit('update', this.state)\n}\n\nfunction makeTagRegExp(_delimiters) {\n  var delimiters = _delimiters || ['{{', '}}']\n\n  return new RegExp(delimiters[0] + '\\\\s*(.*?)\\\\s*' + delimiters[1])\n}\n","module.exports = templatString\n\nfunction templatString(template, change, lookups) {\n  if(!template.match(this.tagRegExp)) {\n    return\n  }\n\n  var remaining = template\n    , parts = []\n    , hooks = []\n    , index\n    , next\n\n  while(remaining && (next = remaining.match(this.tagRegExp))) {\n    if(index = remaining.indexOf(next[0])) {\n      parts.push(remaining.slice(0, index))\n    }\n\n    parts.push('')\n    remaining = remaining.slice(index + next[0].length)\n    lookups.on(next[1], setPart.bind(this, parts.length - 1))\n  }\n\n  if(remaining) {\n    setPart(parts.length, remaining)\n  }\n\n  function setPart(idx, val) {\n    parts[idx] = val\n\n    change(parts.join(''))\n  }\n}\n","var createDecorators = require('./decorators')\n  , createAttr = require('./attributes')\n\nmodule.exports = createElementNode\n\nfunction createElementNode(el, lookups) {\n  var decorators = []\n  var altr = this\n  var attr\n\n  var attrs = Array.prototype.slice.call(el.attributes)\n  var decorators = []\n  var altr_tags = {}\n  var tags = {}\n\n  for(var i = 0, l = attrs.length; i < l; ++i) {\n    if(altr.tags[attrs[i].name]) {\n      altr_tags[attrs[i].name] = attrs[i].value\n    } else if(altr.decorators[attrs[i].name]) {\n      decorators.push(attrs[i])\n    } else if(!attrs[i].name.lastIndexOf('altr-attr-', 0)) {\n      createAttr.altr.call(this, el, attrs[i], lookups)\n    } else if(!attrs[i].name.lastIndexOf('altr-prop-', 0)) {\n      createAttr.prop.call(this, el, attrs[i], lookups)\n    } else {\n      createAttr.raw.call(this, el, attrs[i], lookups)\n    }\n  }\n\n  var hooks = createDecorators.call(altr, el, decorators, lookups)\n\n  for(var i = 0, l = altr.tagList.length; i < l; ++i) {\n    if(attr = altr_tags[altr.tagList[i].attr]) {\n      return hooks.concat([\n          altr.tagList[i].constructor.call(altr, el, attr, lookups, hooks) || {}\n      ])\n    }\n  }\n\n  return hooks.concat(altr.initNodes(el.childNodes, lookups).hooks)\n}\n","module.exports = merge\n\nfunction merge(children) {\n  var altr = this\n\n  return {\n      insert: each.bind(null, 'insert')\n    , destroy: each.bind(null, 'destroy')\n    , remove: remove\n  }\n\n  function each(type, el) {\n    var nodes = children()\n\n    for(var i = 0, l = nodes.length; i < l; i++) {\n      nodes[i][type] && nodes[i][type](el)\n    }\n  }\n\n  function remove(el, ready) {\n    altr.remove(children(), el, ready)\n  }\n}","var extend = require('extend')\n\nmodule.exports = altrExtend\n\nfunction altrExtend(base, options) {\n  var baseOptions = extend(true, base, options)\n  var altr = this\n\n  extension.render = altr.render.bind(altr, baseOptions)\n  extension.extend = altr.extend.bind(altr)\n  extension.addTag = altr.addTag.bind(altr)\n  extension.include = altr.include.bind(altr)\n  extension.addHelper = altr.addHelper.bind(altr)\n  extension.addDecorator = altr.addDecorator.bind(altr)\n\n  return extension\n\n  function extension(root, state, options) {\n    return new altr(root, state, extend(\n        true\n      , Object.create(baseOptions)\n      , options || {}\n    ))\n  }\n}\n","module.exports = initTextNode\n\nfunction initTextNode(el, lookups) {\n  this.templateString(\n      el.textContent\n    , this.batch.add(update)\n    , lookups\n  )\n\n  function update(val) {\n    el.textContent = val\n  }\n}\n","module.exports = toString\n\nfunction toString() {\n  return this.rootNodes().map(function(node) {\n    switch(node.nodeType) {\n      case this.document.DOCUMENT_FRAGMENT_NODE:\n      case this.document.COMMENT_NODE: return clone.call(this, node)\n      case this.document.TEXT_NODE: return node.textContent\n      default: return node.outerHTML\n    }\n  }, this).join('')\n\n  function clone(node) {\n    var temp = this.document.createElement('div')\n\n    temp.appendChild(node.cloneNode(true))\n\n    return temp.innerHTML\n  }\n}\n","module.exports = runHooks\n\nfunction runHooks(hooks, type, el) {\n  for(var i = 0, l = hooks.length; i < l; i++) {\n    hooks[i][type] && hooks[i][type](el)\n  }\n}\n","module.exports = get\n\nfunction get(_el) {\n  var el = _el\n\n  while(el && el._altrPlaceholder) {\n    el = el._altrPlaceholder\n\n    if(el === _el) {\n      throw new Error('placeholder circular refference')\n    }\n  }\n\n  return el\n}\n","module.exports = destroy\n\nfunction destroy(children, el, done) {\n  var altr = this\n\n  altr.remove(children, el, function(el) {\n    altr.runHooks(children, 'destroy', el)\n    done()\n  })\n}\n","module.exports = render\n\nfunction render(template, state, el) {\n  if(this.includes[template]) {\n    template = this.includes[template]\n  }\n\n  var instance = this(template)\n\n  instance.update(state || {}, true)\n\n  if(el) {\n    instance.into(el)\n  }\n\n  return instance\n}\n","module.exports = remove\n\nfunction remove(hooks, el, ready) {\n  var remaining = hooks.length\n  var c = 0\n\n  for(var i = 0, l = remaining; i < l; i++) {\n    hooks[i].remove ? hooks[i].remove(el, done) : --remaining\n  }\n\n  if(!remaining) {\n    ready()\n  }\n\n  function done() {\n    if(!--remaining) {\n      remaining = -1\n      ready()\n    }\n  }\n}","module.exports = requestAnimationFrame\n\nfunction requestAnimationFrame(callback) {\n  var raf = global.requestAnimationFrame ||\n    global.webkitRequestAnimationFrame ||\n    global.mozRequestAnimationFrame ||\n    timeout\n\n  return raf(callback)\n\n  function timeout(callback) {\n    return setTimeout(callback, 1000 / 60)\n  }\n}\n","var get = require('./get-element')\n\nmodule.exports = setChildren\n\nfunction setChildren(root, nodes) {\n  var prev = null\n    , el\n\n  for(var i = nodes.length - 1; i >= 0; --i) {\n    el = get(nodes[i])\n    root.insertBefore(el, prev)\n    prev = el\n  }\n\n  while((el = root.firstChild) !== prev) {\n    root.removeChild(el)\n  }\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      }\n      throw TypeError('Uncaught, unspecified \"error\" event.');\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        len = arguments.length;\n        args = new Array(len - 1);\n        for (i = 1; i < len; i++)\n          args[i - 1] = arguments[i];\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    len = arguments.length;\n    args = new Array(len - 1);\n    for (i = 1; i < len; i++)\n      args[i - 1] = arguments[i];\n\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    var m;\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  var ret;\n  if (!emitter._events || !emitter._events[type])\n    ret = 0;\n  else if (isFunction(emitter._events[type]))\n    ret = 1;\n  else\n    ret = emitter._events[type].length;\n  return ret;\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","module.exports = decorators\n\nfunction decorators(el, attrs, lookups) {\n  var altr = this\n  var hooks = []\n\n  return attrs.map(createDecorator)\n\n  function createDecorator(attr) {\n    var decorator = altr.decorators[attr.name].call(altr, el)\n    var expression = '[' + attr.value + ']'\n\n    if(!decorator) {\n      return\n    }\n\n    var hooks = {insert: decorator.insert, remove: decorator.remove}\n\n    if(decorator.update) {\n      lookups.on(expression, update)\n    }\n\n    hooks.destroy = destroy\n\n    return hooks\n\n    function destroy() {\n      if(decorator.update) lookups.removeListener(expression, update)\n\n      if(decorator.destroy) {\n        decorator.destroy()\n      }\n    }\n\n    function update(args) {\n      decorator.update.apply(null, args)\n    }\n  }\n}\n","module.exports.raw = rawAttribute\nmodule.exports.altr = altrAttribute\nmodule.exports.prop = altrProperty\n\nfunction rawAttribute(el, attr, lookups) {\n  this.templateString(\n      attr.value\n    , this.batch.add(el.setAttribute.bind(el, attr.name))\n    , lookups\n  )\n}\n\nfunction altrAttribute(el, attr, lookups) {\n  var name = attr.name.slice('altr-attr-'.length)\n\n  lookups.on(attr.value, this.batch.add(update))\n  el.removeAttribute(attr.name)\n\n  function update(val) {\n    if(!val && val !== '' && val !== 0) {\n      return el.removeAttribute(name)\n    }\n\n    el.setAttribute(name, val)\n  }\n}\n\nfunction altrProperty(el, attr, lookups) {\n  var name = attr.name.slice('altr-prop-'.length)\n\n  el.removeAttribute(attr.name)\n  lookups.on(attr.value, this.batch.add(update))\n\n  function update(val) {\n    el[name] = val\n  }\n}\n","module.exports = Batch\n\nfunction Batch(ready, all) {\n  if(!(this instanceof Batch)) {\n    return new Batch(ready, all)\n  }\n\n  this.jobs = []\n  this.all = all\n  this.ready = ready\n  this.queud = false\n  this.run = this.run.bind(this)\n}\n\nBatch.prototype.queue = queue\nBatch.prototype.add = add\nBatch.prototype.run = run\n\nfunction add(fn) {\n  var queued = false\n    , batch = this\n    , self\n    , args\n\n  return queue\n\n  function queue() {\n    args = [].slice.call(arguments)\n    self = this\n\n    if(queued) {\n      return batch.all && batch.ready()\n    }\n\n    queued = true\n    batch.queue(run)\n  }\n\n  function run() {\n    queued = false\n    fn.apply(self, args)\n  }\n}\n\nfunction queue(fn) {\n  this.jobs.push(fn)\n\n  if(this.all || !this.queued) {\n    this.queued = true\n    this.ready(this)\n  }\n}\n\nfunction run() {\n  var jobs = this.jobs\n\n  this.jobs = []\n  this.queued = false\n\n  for(var i = 0, l = jobs.length; i < l; ++i) {\n    jobs[i]()\n  }\n\n  return !!jobs.length\n}\n","var hasOwn = Object.prototype.hasOwnProperty;\nvar toString = Object.prototype.toString;\nvar undefined;\n\nvar isPlainObject = function isPlainObject(obj) {\n\t\"use strict\";\n\tif (!obj || toString.call(obj) !== '[object Object]' || obj.nodeType || obj.setInterval) {\n\t\treturn false;\n\t}\n\n\tvar has_own_constructor = hasOwn.call(obj, 'constructor');\n\tvar has_is_property_of_method = obj.constructor && obj.constructor.prototype && hasOwn.call(obj.constructor.prototype, 'isPrototypeOf');\n\t// Not own constructor property must be Object\n\tif (obj.constructor && !has_own_constructor && !has_is_property_of_method) {\n\t\treturn false;\n\t}\n\n\t// Own properties are enumerated firstly, so to speed up,\n\t// if last one is own, then all properties are own.\n\tvar key;\n\tfor (key in obj) {}\n\n\treturn key === undefined || hasOwn.call(obj, key);\n};\n\nmodule.exports = function extend() {\n\t\"use strict\";\n\tvar options, name, src, copy, copyIsArray, clone,\n\t\ttarget = arguments[0],\n\t\ti = 1,\n\t\tlength = arguments.length,\n\t\tdeep = false;\n\n\t// Handle a deep copy situation\n\tif (typeof target === \"boolean\") {\n\t\tdeep = target;\n\t\ttarget = arguments[1] || {};\n\t\t// skip the boolean and the target\n\t\ti = 2;\n\t} else if (typeof target !== \"object\" && typeof target !== \"function\" || target == undefined) {\n\t\t\ttarget = {};\n\t}\n\n\tfor (; i < length; ++i) {\n\t\t// Only deal with non-null/undefined values\n\t\tif ((options = arguments[i]) != null) {\n\t\t\t// Extend the base object\n\t\t\tfor (name in options) {\n\t\t\t\tsrc = target[name];\n\t\t\t\tcopy = options[name];\n\n\t\t\t\t// Prevent never-ending loop\n\t\t\t\tif (target === copy) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Recurse if we're merging plain objects or arrays\n\t\t\t\tif (deep && copy && (isPlainObject(copy) || (copyIsArray = Array.isArray(copy)))) {\n\t\t\t\t\tif (copyIsArray) {\n\t\t\t\t\t\tcopyIsArray = false;\n\t\t\t\t\t\tclone = src && Array.isArray(src) ? src : [];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tclone = src && isPlainObject(src) ? src : {};\n\t\t\t\t\t}\n\n\t\t\t\t\t// Never move original objects, clone them\n\t\t\t\t\ttarget[name] = extend(deep, clone, copy);\n\n\t\t\t\t// Don't bring in undefined values\n\t\t\t\t} else if (copy !== undefined) {\n\t\t\t\t\ttarget[name] = copy;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Return the modified object\n\treturn target;\n};\n\n","var Expression = require('./expression')\nvar remove = require('./remove')\nvar parse = require('./parse')\nvar watch = require('./watch')\n\nmodule.exports = DirtyBit\n\nfunction DirtyBit(state, options) {\n  if(!(this instanceof DirtyBit)) {\n    return new DirtyBit(state, options)\n  }\n\n  this.options = options || {}\n\n  this.state = state || {}\n  this.helpers = Object.create(this.options.helpers || null)\n  this.values = {}\n  this.watched = []\n  this.expressions = {\n    list: [],\n    map: {}\n  }\n\n  this.handlers = {}\n  this.always = {}\n  this.updating = false\n\n  this.rootKey = this.options.rootKey\n\n  this.rootExpression = new Expression('this', 'root', null, this.state)\n  this.expressions.map.this = this.rootExpression\n  this.rootExpression.removable = false\n\n\n  if(this.rootKey) {\n    this.expressions[this.rootKey] = this.rootExpression\n  }\n}\n\nDirtyBit.prototype.removeListener = remove\nDirtyBit.prototype.addHelper = addHelper\nDirtyBit.prototype.update = update\nDirtyBit.prototype.report = report\nDirtyBit.prototype.parse = parse\nDirtyBit.prototype.watch = watch\nDirtyBit.prototype.on = on\n\nDirtyBit.parsed = {}\n\nfunction update(state) {\n  this.state = state\n  this.updating = true\n  for(var i = 0, l = this.watched.length; i < l; ++i) {\n    this.watched[i].update()\n  }\n  this.updating = false\n  this.report()\n}\n\nfunction report() {\n  var lookups = Object.keys(this.handlers)\n\n  for(var i = 0, l = lookups.length; i < l; ++i) {\n    var expression = this.expressions.map[lookups[i]]\n    var handlers = this.handlers[lookups[i]].always\n    for(var j = 0, l2 = handlers.length; j < l2; ++j) {\n      handlers[j](expression.value)\n    }\n    if(!expression.changed) continue\n    handlers = this.handlers[lookups[i]].update\n    for(var j = 0, l2 = handlers.length; j < l2; ++j) {\n      handlers[j](expression.value)\n    }\n\n    expression.changed = false\n  }\n}\n\nfunction addHelper(name, helper) {\n  this.helpers[name] = helper\n}\n\nfunction on(lookup, handler, always) {\n  var exp = this.expressions.map[lookup]\n  if(!exp) {\n    this.updating = true\n    exp = this.watch(lookup)\n    this.updating = false\n  }\n\n  if(!this.handlers[lookup]) {\n    this.handlers[lookup] = {\n      always: [],\n      update: [],\n    }\n  }\n\n  if(always) {\n    this.handlers[lookup].always.push(handler)\n  } else {\n    this.handlers[lookup].update.push(handler)\n  }\n  handler(exp.value)\n  return this\n}\n","module.exports = Expression\n\nfunction Expression(lookup, type, update, value) {\n  this.dependents = []\n  this.deps = []\n  this.lookup = lookup\n  this.type = type\n  this.changed = false\n  this.update = update\n  this.depValues = []\n  this.value = value\n  this.removable = true\n}\n\nExpression.prototype.setValue = setValue\nExpression.prototype.addDep = addDep\n\nfunction setValue(value) {\n  if(this.value === value && typeof value !== 'object') return\n\n  this.value = value\n  this.changed = true\n  for(var i = 0, l = this.dependents.length; i < l; ++i) {\n    this.dependents[i](value)\n  }\n}\n\nfunction addDep(dep) {\n  var i = this.deps.length\n  this.deps[i] = dep\n  var self = this\n  dep.dependents.push(function(val) {\n    self.depValues[i] = val\n    self.update(self.depValues)\n  })\n  this.depValues[i] = dep.value\n}\n","module.exports = remove\n\nfunction remove(_lookup, handler) {\n  if(!this.watch.seen[_lookup]) return\n  var lookup = this.watch.seen[_lookup].value\n  var handlers = this.handlers[lookup]\n\n  if(!handlers) {\n    return\n  }\n\n  var index\n  if((index = handlers.update.indexOf(handler)) !== -1) {\n    handlers.update.splice(index, 1)\n  }\n\n  if((index = handlers.always.indexOf(handler)) !== -1) {\n    handlers.always.splice(index, 1)\n  }\n\n  if(handlers.always.length || handlers.update.length) {\n    return\n  }\n\n  delete this.handlers[lookup]\n  removeExpression(this, this.expressions.map[lookup])\n}\n\nfunction removeExpression(self, expression) {\n  if(expression.dependents.length || !expression.removable) {\n    return\n  }\n\n\n  delete self.expressions.map[expression.lookup]\n\n  var list = expression.type === 'label' ? self.watched : self.expressions.list\n  var index = list.indexOf(expression)\n\n  if(index !== -1) {\n    list.splice(index, 1)\n  }\n\n  for(var i = 0, l = expression.deps.length, dep; i < l; ++i) {\n    dep = expression.deps[i]\n    dep.dependents.splice(dep.dependents.indexOf(expression), 1)\n    if(!self.handlers[dep.lookup]) removeExpression(self, dep)\n  }\n}\n","var types = [group, array, keyword, number, string, label, unary]\nvar continuations = [helper, member, index, binary, ternary]\nvar keywords = ['true', 'false', 'null', 'undefined']\nvar keywordValues = [true, false, null, undefined]\nvar unaryOperators = ['!', '+', '-', '~', 'void', 'instanceof']\nvar whitesapce = ' \\xA0\\uFEFF\\f\\n\\r\\t\\v\\u00a0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000'.split('')\nvar reservedCharacters = whitesapce.concat('(){}[]|&^=><+-*%/\\\\!@#\\'\"~.,?:`'.split(''))\nvar boundary = whitesapce.concat(['('])\nvar binaryOperators = {\n  '%': 5,\n  '/': 5,\n  '*': 5,\n  '-': 6,\n  '+': 6,\n  '>>': 7,\n  '<<': 7,\n  '>>>': 7,\n  '<': 8,\n  '>': 8,\n  '<=': 8,\n  '>=': 8,\n  instanceof: 8,\n  in: 8,\n  '!=': 9,\n  '==': 9,\n  '!==': 9,\n  '===': 9,\n  '&': 10,\n  '|': 11,\n  '^': 12,\n  '&&': 13,\n  '||': 14\n}\n\nvar sortedBinaryOperators = Object.keys(binaryOperators).sort(function(l, r) {\n  return l.length < r.length ? 1 : -1\n})\n\nmodule.exports.parse = parse\n\nfunction parse(str) {\n  return trim(str, expression, 0)\n}\n\nfunction expression(str, start, end) {\n  if(!str || !str[start]) return null\n  for(var i = 0, l = types.length; i < l; ++i) {\n    var node = types[i](str, start, end)\n    if(node) break\n  }\n\n  if(!node) {\n    throw new Error(\n      'Unexpected token: ' + str[start] + ' in \"' + str.slice(start, 20) + '\"'\n    )\n  }\n\n  var cur = node.range[1]\n  while(whitesapce.indexOf(str[cur]) !== -1) cur = cur + 1\n\n  return end.indexOf(str[cur]) !== -1 ? node : continueExpression(str, node, end)\n}\n\nfunction continueExpression(str, node, end) {\n  var start = node.range[1]\n  while(str[start] && end.indexOf(str[start]) === -1) {\n    node = trim(str, findContinuation, start, end)\n    start = node.range[1]\n    while(whitesapce.indexOf(str[start]) !== -1) start = start + 1\n  }\n\n  if(end.indexOf(str[start]) === -1) {\n    throw new Error(\n      'Expected to find token: ' + end\n    )\n  }\n\n  return node\n\n  function findContinuation(str, start, end) {\n    for(var i = 0, l = continuations.length; i < l; ++i) {\n      var continuation = continuations[i](node, str, start, end)\n      if(continuation) break\n    }\n\n    if(!continuation) {\n      throw new Error(\n        'Unexpected token: ' + str[start] + ' in \"' + str.slice(start, start + 20) + '\"'\n      )\n    }\n\n    return continuation\n  }\n}\n\nfunction keyword(str, start) {\n  for(var i = 0, l = keywords.length; i < l; ++i) {\n    var word = keywords[i]\n    for(var j = 0, l2 = word.length; j < l2; ++j) {\n      if(str[start + j] !== word[j]) break\n    }\n\n    if(j === l2) break\n  }\n\n  if(i === l) return null\n\n  return new Node(\n    'keyword',\n    [start, start + word.length],\n    str,\n    null,\n    true,\n    keywordValues[word]\n  )\n}\n\nfunction string(str, start) {\n  var open = str[start]\n  if(open !== '\"' && open !== '\\'') return null\n  var cur = start + 1\n  var chr\n  while((chr = str[cur]) && chr !== open) {\n    if(str === '\\\\') ++cur\n    cur = cur + 1\n  }\n\n  if(str[cur++] !== open) throw new Error('Expected string to be closed')\n  return new Node(\n    'string',\n    [start, cur],\n    str,\n    null,\n    true,\n    str.slice(start + 1, cur - 1)\n  )\n}\n\nfunction number(str, start) {\n  var decimal = false\n  var cur = start\n  var chr\n  while(chr = str[cur]) {\n    if(chr === '.') {\n      if(decimal) break\n      decimal = true\n      cur = cur + 1\n      continue\n    }\n    if(chr < '0' || chr > '9') break\n    cur = cur + 1\n  }\n\n  return cur - start ? new Node(\n    'number',\n    [start, cur],\n    str,\n    null,\n    true,\n    parseInt(str.slice(start, cur), 10)\n  ) : null\n}\n\nfunction label(str, start) {\n  var chr = str[start]\n  if(chr < 0 || chr > 9 || reservedCharacters.indexOf(chr) !== -1) return null\n  var cur = start + 1\n\n  while(chr = str[cur]) {\n    if(reservedCharacters.indexOf(chr) !== -1) break\n    cur = cur + 1\n  }\n\n  return new Node('label', [start, cur], str, null)\n}\n\nfunction array(str, start) {\n  if(str[start] !== '[') return null\n  var cur = start + 1\n  var children = []\n  var next\n  var ends = [',', ']']\n  while(next = trim(str, expression, cur, ends)) {\n    children.push(next)\n    cur = next.range[1]\n    while(ends.indexOf(str[cur]) === -1) cur = cur + 1\n    if(str[cur] === ']') break\n    cur = cur + 1\n  }\n\n  return new Node('array', [start, cur + 1], str, {\n    children: children,\n  })\n}\n\nfunction group(str, start) {\n  if(str[start] !== '(') return null\n\n  var node = trim(str, expression, start + 1, [')'])\n  var end = node.range[1]\n  while(whitesapce.indexOf(str[end]) !== -1) end = end + 1\n  return new Node('group', [start, end + 1], str, {\n    expression: node\n  })\n}\n\nfunction helper(left, str, start, end) {\n  if(left.type !== 'label' || str[start] !== '(') return\n  var cur = start + 1\n  var children = []\n  var next\n  var ends = [',', ')']\n  while(next = trim(str, expression, cur, ends)) {\n    children.push(next)\n    cur = next.range[1]\n    while(ends.indexOf(str[cur]) === -1) cur = cur + 1\n    if(str[cur] === ')') break\n    cur = cur + 1\n  }\n\n  cur = cur + 1\n\n  return new Node('helper', [left.range[0], cur], str, {\n    left: left,\n    children: children,\n  })\n}\n\nfunction member(left, str, start) {\n  if(str[start] !== '.') return null\n  var node = label(str, start + 1)\n\n  if(!node) throw new Error('Expected Label')\n  return new Node('member', [left.range[0], node.range[1]], str, {\n    left: left,\n    right: node,\n  })\n}\n\nfunction index(left, str, start) {\n  if(str[start] !== '[') return null\n  var node = trim(str, expression, start + 1, [']'])\n  var end = node.range[1] + 1\n  while(whitesapce.indexOf(str[end]) !== -1) end = end + 1\n  return new Node('index', [left.range[0], end], str, {\n    left: left,\n    right: node,\n  })\n}\n\nfunction unary(str, start, end) {\n  for(var i = 0, l = unaryOperators.length; i < l; ++i) {\n    var op = unaryOperators[i]\n    for(var j = 0, l2 = op.length; j < l2; ++j) {\n      if(str[start + j] !== op[j]) break\n    }\n\n    if(j === l2) break\n  }\n\n  if(i === l) return null\n  var len = op.length\n  var next = str[start + len]\n  if(len > 1 && boundary.indexOf(next) === '-1') return null\n  var child = trim(str, expression, start + len, end)\n  var node = new Node('unary', [start, child.range[1]], str, {\n    op: op,\n    right: child,\n    presidence: 4\n  })\n\n  if(child.presidence && child.presidence > 4) {\n    node.right = child.left\n    child.left = node\n    return child\n  }\n\n  return node\n}\n\nfunction binary(left, str, start, end) {\n  for(var i = 0, l = sortedBinaryOperators.length; i < l; ++i) {\n    var op = sortedBinaryOperators[i]\n    for(var j = 0, l2 = op.length; j < l2; ++j) {\n      if(str[start + j] !== op[j]) break\n    }\n\n    if(j === l2) break\n  }\n\n  if(i === l) return null\n  if(op === 'in' || op === 'instanceof') {\n    var next = str[start + op.length]\n    if(boundary.indexOf(next) === -1) return null\n  }\n\n  var presidence = binaryOperators[op]\n  var right = trim(str, expression, start + op.length, end)\n  var node = new Node('binary', [left.range[0], right.range[1]], str, {\n    op: op,\n    left: left,\n    right: right,\n    presidence: presidence\n  })\n\n  if(right.presidence && right.presidence >= presidence) {\n    node.right = right.left\n    right.left = node\n    return right\n  }\n\n  return node\n}\n\nfunction ternary(condition, str, start, end) {\n  if(str[start] !== '?') return null\n  var ok = trim(str, expression, start + 1, [':'])\n  if(!ok) throw new Error('Expected token: \":\"')\n  var next = ok.range[1] + 1\n  while(whitesapce.indexOf(str[next]) !== -1) next = next + 1\n  var not = trim(str, expression, next + 1, end)\n\n  return new Node('ternary', [condition.range[0], not.range[1]], str, {\n    left: condition,\n    middle: ok,\n    right: not,\n    presidence: 15\n  })\n}\n\nfunction trim(str, parse, start, end) {\n  while(chr = str[start]) {\n    if(whitesapce.indexOf(chr) === -1) break\n    start = start + 1\n  }\n\n  return parse(str, start, end || [undefined])\n}\n\nfunction Node(type, range, str, data, litteral, val) {\n  this.type = type\n  this.range = range\n  this.value = str.slice(range[0], range[1])\n  this.data = data\n  this.litteral = !!litteral\n  this.rawValue = val\n}\n","var Expression = require('./expression')\nvar Parser = require('./parse')\nvar build = require('./build')\n\nvar seen = {}\n\nmodule.exports = watch\nmodule.exports.seen = seen\n\nfunction watch(lookup) {\n  var parsed = seen[lookup] || (seen[lookup] = Parser.parse(lookup))\n\n  return watchNode.call(this, parsed)\n}\n\nfunction watchNode(node, parent) {\n  var exp\n\n  if(node.type === 'label') {\n    exp = addLabel.call(this, node)\n  } else if(node.type === 'helper') {\n    exp = addHelper.call(this, node)\n  } else {\n    exp = addExpression.call(this, node)\n  }\n\n  if(parent) {\n    parent.addDep(exp)\n  }\n\n  return exp\n}\n\nfunction addLabel(label, parent) {\n  var self = this\n  var key = label.value\n  if(this.expressions.map[key]) {\n    return this.expressions.map[key]\n  }\n  var exp = new Expression(key, 'label', lookup)\n  this.watched.push(exp)\n  this.expressions.map[key] = exp\n  exp.update()\n  if(parent) parent.addDep(exp)\n  exp.changed = false\n\n  return exp\n\n  function lookup() {\n    this.setValue(\n      (self.state === null) || (typeof self.state === 'undefined') ?\n      undefined :\n      self.state[key]\n    )\n  }\n}\n\nfunction addExpression(node) {\n  var lookup = node.value\n  if(this.expressions.map[lookup]) {\n    return this.expressions.map[lookup]\n  }\n\n  var built = build(node)\n\n  var exp = new Expression(\n    lookup,\n    'expression',\n    updateExpression(built.compiled)\n  )\n\n  this.expressions.map[lookup] = exp\n  this.expressions.list.push(exp)\n  addDeps.call(this, exp, built.deps)\n  exp.update()\n  exp.changed = false\n\n  return exp\n}\n\nfunction addDeps(parent, deps) {\n  for(var i = 0, l = deps.length; i < l; ++i) {\n    if(deps[i].litteral) {\n      parent.depValues[i] = deps[i].rawValue\n      continue\n    }\n\n    watchNode.call(this, deps[i], parent)\n  }\n}\n\nfunction addHelper(node) {\n  var self = this\n  var key = node.value\n  var name = node.data.left.value\n  if(this.expressions.map[key]) {\n    return this.expressions.map[key]\n  }\n  var helper = this.helpers[name]\n  if(!helper) throw new Error('could not find handler: ' + name)\n  var update = helper(change)\n  var exp = new Expression(key, 'helper', function(args) {\n    update.apply(null, args)\n  })\n  this.expressions.map[key] = exp\n  this.expressions.list.push(exp)\n  addDeps.call(this, exp, node.data.children)\n  update.apply(null, exp.depValues)\n  exp.changed = false\n\n  return exp\n\n  function change(val) {\n    if(self.updating) return exp.setValue(val)\n    self.updating = true\n    exp.setValue(val)\n    self.updating = false\n    self.report()\n  }\n}\n\nfunction updateExpression(run) {\n  return function() {\n    this.setValue(run.apply(null, this.depValues))\n  }\n}\n","module.exports = function(node) {\n  var built = build(node, [])\n  return {\n    deps: built.deps,\n    raw: node.value,\n    body: built.body,\n    compiled: compile(built.body),\n  }\n}\n\nfunction build(node, deps) {\n  if(node.type === 'group') {\n    var group = build(node.data.expression, deps)\n    return {\n      deps: group.deps,\n      body: '(' + group.body + ')'\n    }\n  }\n\n  if(node.type === 'number' || node.type === 'string' || node.type === 'keyword') {\n    return {body: node.value, deps: []}\n  }\n\n  if(node.type === 'unary') {\n    var child = build(node.data.right, deps)\n    return {body: node.data.op + '(' + child.body + ')', deps: child.deps}\n  }\n\n  if(node.type === 'label' || node.type === 'helper') {\n    var newDeps = addDep(node, deps)\n    return {body: 'arguments[' + newDeps.index + ']', deps: newDeps.deps}\n  }\n\n  if(node.type === 'member') {\n    var left = build(node.data.left, deps)\n    'this.lookup(' + left.body + ', \"' + node.data.right.value + '\")'\n    return {\n      body: 'this.lookup(' + left.body + ', \"' + node.data.right.value + '\")',\n      deps: left.deps\n    }\n  }\n\n  if(node.type === 'index') {\n    var left = build(node.data.left, deps)\n    var right = build(node.data.right, deps.concat(left.deps))\n    return {\n      body: 'this.lookup(' + left.body + ', ' + right.body + ')',\n      deps: left.deps.concat(right.deps)\n    }\n  }\n\n  if(node.type === 'binary') {\n    var left = build(node.data.left, deps)\n    var right = build(node.data.right, deps.concat(left.deps))\n    return {\n      body: left.body + ' ' + node.data.op + ' ' + right.body,\n      deps: left.deps.concat(right.deps)\n    }\n  }\n\n  if(node.type === 'ternary') {\n    var left = build(node.data.left, deps)\n    var middle = build(node.data.middle, deps)\n    var right = build(node.data.right, deps.concat(left.deps))\n    return {\n      body: left.body + ' ? ' + middle.body + ' : ' + right.body,\n      deps: left.deps.concat(middle.deps, right.deps)\n    }\n  }\n\n  if(node.type === 'helper') {\n    var newDeps = addDep(node, deps)\n    return {body: 'arguments[' + newDeps.index + ']', deps: newDeps.deps}\n  }\n\n  if(node.type === 'array') {\n    var allDeps = deps\n    var newDeps = []\n    var deps = []\n    var body = '['\n    var child\n    for(var i = 0, l = node.data.children.length - 1; i < l; ++i) {\n      child = build(node.data.children[i], allDeps)\n      body += child.body + ', '\n      newDeps = newDeps.concat(child.deps)\n      allDeps = deps.concat(newDeps)\n    }\n\n    child = build(node.data.children[i], allDeps)\n\n    return {\n      body: body += child.body + ']',\n      deps: newDeps.concat(child.deps)\n    }\n  }\n}\n\nfunction addDep(node, deps) {\n  for(var i = 0, l = deps.length; i < l; ++i) {\n    if(node.value === deps[i].value) break\n  }\n\n  if(i === l) return {index: i, deps: [node]}\n  return {index: i, deps: []}\n}\n\nfunction compile(raw) {\n  return new Function('', 'return (' + raw + ')').bind({\n    lookup: lookup\n  })\n}\n\nfunction lookup(root, prop) {\n  return typeof root === 'null' || typeof root === 'undefined' ?\n    undefined :\n    root[prop]\n}\n"]}